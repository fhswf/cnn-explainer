var app=function(){"use strict";function t(){}function e(t){return t()}function a(){return Object.create(null)}function l(t){t.forEach(e)}function n(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let r,o;function i(t,e){return r||(r=document.createElement("a")),r.href=e,t===r.href}function d(t,e){t.appendChild(e)}function c(t,e,a){t.insertBefore(e,a||null)}function g(t){t.parentNode&&t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function h(){return p(" ")}function y(){return p("")}function m(t,e,a,l){return t.addEventListener(e,a,l),()=>t.removeEventListener(e,a,l)}function f(t,e,a){null==a?t.removeAttribute(e):t.getAttribute(e)!==a&&t.setAttribute(e,a)}function x(t,e,a){e in t?t[e]="boolean"==typeof t[e]&&""===a||a:f(t,e,a)}function v(t,e){e=""+e,t.data!==e&&(t.data=e)}function b(t,e){t.value=null==e?"":e}function $(t,e,a,l){null==a?t.style.removeProperty(e):t.style.setProperty(e,a,l?"important":"")}function w(t,e,a){for(let a=0;a<t.options.length;a+=1){const l=t.options[a];if(l.__value===e)return void(l.selected=!0)}a&&void 0===e||(t.selectedIndex=-1)}function k(t,e,a){t.classList[a?"add":"remove"](e)}function I(t){o=t}function L(){if(!o)throw new Error("Function called outside component initialization");return o}function M(t){L().$$.on_mount.push(t)}function A(t){L().$$.after_update.push(t)}function E(){const t=L();return(e,a,{cancelable:l=!1}={})=>{const n=t.$$.callbacks[e];if(n){const s=function(t,e,{bubbles:a=!1,cancelable:l=!1}={}){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,a,l,e),n}(e,a,{cancelable:l});return n.slice().forEach(e=>{e.call(t,s)}),!s.defaultPrevented}return!0}}const R=[],C=[];let S=[];const _=[],N=Promise.resolve();let H=!1;function P(t){S.push(t)}const O=new Set;let B=0;function X(){if(0!==B)return;const t=o;do{try{for(;B<R.length;){const t=R[B];B++,I(t),G(t.$$)}}catch(t){throw R.length=0,B=0,t}for(I(null),R.length=0,B=0;C.length;)C.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];O.has(e)||(O.add(e),e())}S.length=0}while(R.length);for(;_.length;)_.pop()();H=!1,O.clear(),I(t)}function G(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(P)}}const q=new Set;let z;function F(){z={r:0,c:[],p:z}}function T(){z.r||l(z.c),z=z.p}function j(t,e){t&&t.i&&(q.delete(t),t.i(e))}function D(t,e,a,l){if(t&&t.o){if(q.has(t))return;q.add(t),z.c.push(()=>{q.delete(t),l&&(a&&t.d(1),l())}),t.o(e)}else l&&l()}function V(t){t&&t.c()}function K(t,a,s,r){const{fragment:o,after_update:i}=t.$$;o&&o.m(a,s),r||P(()=>{const a=t.$$.on_mount.map(e).filter(n);t.$$.on_destroy?t.$$.on_destroy.push(...a):l(a),t.$$.on_mount=[]}),i.forEach(P)}function W(t,e){const a=t.$$;null!==a.fragment&&(!function(t){const e=[],a=[];S.forEach(l=>-1===t.indexOf(l)?e.push(l):a.push(l)),a.forEach(t=>t()),S=e}(a.after_update),l(a.on_destroy),a.fragment&&a.fragment.d(e),a.on_destroy=a.fragment=null,a.ctx=[])}function Y(t,e){-1===t.$$.dirty[0]&&(R.push(t),H||(H=!0,N.then(X)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function U(e,n,s,r,i,d,c,u=[-1]){const p=o;I(e);const h=e.$$={fragment:null,ctx:[],props:d,update:t,not_equal:i,bound:a(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(p?p.$$.context:[])),callbacks:a(),dirty:u,skip_bound:!1,root:n.target||p.$$.root};c&&c(h.root);let y=!1;if(h.ctx=s?s(e,n.props||{},(t,a,...l)=>{const n=l.length?l[0]:a;return h.ctx&&i(h.ctx[t],h.ctx[t]=n)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](n),y&&Y(e,t)),a}):[],h.update(),y=!0,l(h.before_update),h.fragment=!!r&&r(h.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);h.fragment&&h.fragment.l(t),t.forEach(g)}else h.fragment&&h.fragment.c();n.intro&&j(e.$$.fragment),K(e,n.target,n.anchor,n.customElement),X()}I(p)}class J{$destroy(){W(this,1),this.$destroy=t}$on(e,a){if(!n(a))return t;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(a),()=>{const t=l.indexOf(a);-1!==t&&l.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Q=[];function Z(e,a=t){let l;const n=new Set;function r(t){if(s(e,t)&&(e=t,l)){const t=!Q.length;for(const t of n)t[1](),Q.push(t,e);if(t){for(let t=0;t<Q.length;t+=2)Q[t][0](Q[t+1]);Q.length=0}}}return{set:r,update:function(t){r(t(e))},subscribe:function(s,o=t){const i=[s,o];return n.add(i),1===n.size&&(l=a(r)||t),s(e),()=>{n.delete(i),0===n.size&&l&&(l(),l=null)}}}}const tt=Z([]),et=Z(void 0),at=Z(void 0),lt=Z(void 0),nt=Z([]),st=Z(void 0),rt=Z({}),ot=Z([]),it=Z([void 0,void 0]),dt=Z(!0),ct=Z(!1),gt=Z(!1),ut=Z({}),pt=Z(!1),ht=Z({}),yt=Z({}),mt=Z({}),ft=(t,e,a)=>{let l=[];for(let n=0;n<t;n++){let t=new Array(e).fill(a);l.push(t)}return l},xt=(t,e)=>{console.assert(t.length===e.length,"Dimension not matching"),console.assert(t[0].length===e[0].length,"Dimension not matching");let a=0;for(let l=0;l<t.length;l++)for(let n=0;n<t[0].length;n++)a+=t[l][n]*e[l][n];return a},vt=(t,e,a,l,n)=>t.slice(e,a).map(t=>t.slice(l,n)),bt=t=>{let e=-1/0;for(let a=0;a<t.length;a++)for(let l=0;l<t[0].length;l++)t[a][l]>e&&(e=t[a][l]);return e},$t=(t,e,a=1,l=0)=>{console.assert(t.length===t[0].length,"Conv input is not square"),console.assert(e.length===e[0].length,"Conv kernel is not square");let n=(t.length-e.length)/a+1,s=ft(n,n,0);for(let l=0;l<n;l++)for(let r=0;r<n;r++){let n=vt(t,l*a,l*a+e.length,r*a,r*a+e.length),o=xt(n,e);s[l][r]=o}return s},wt=(t,e=2,a=2,l="VALID")=>{console.assert(2===e,"Only supports kernen = [2,2]"),console.assert(2===a,"Only supports stride = 2"),console.assert("VALID"===l,"Only support valid padding"),t.length%2==1&&"VALID"===l&&(t=vt(t,0,t.length-1,0,t.length-1));let n=(t.length-e)/a+1,s=ft(n,n,0);for(let l=0;l<n;l++)for(let r=0;r<n;r++){let n=vt(t,l*a,l*a+e,r*a,r*a+e);s[l][r]=bt(n)}return s};function kt(t,e){return Array.from({length:t},e?(t,a)=>e(a):void 0)}function It(t,e,a){return Array.from({length:t},(t,l)=>Array.from({length:e},a?(t,e)=>a(l,e):void 0))}function Lt(t,e,a,l,n){const s=It(e.length,e.length,(t,e)=>It(a,a));for(let r=0;r<e.length;r++)for(let o=0;o<e.length;o++)for(let e=0;e<a;e++)for(let i=0;i<a;i++){const a=r*t+e*n,d=o*t+i*n;s[r][o][e][i]=a*l+d}return s}function Mt(t,e,a,l,n,s){const r=kt(a*a);for(let a=0;a<s;a++)for(let l=0;l<s;l++){const s=n[t][e][a][l];void 0!==s&&(r[s]=[a,l])}return r}function At(t,e,a){var l=e.reduce((t,e,a)=>(null!=e&&t.push(a),t),[]);return vt(t,Math.floor(l[0]/t.length),Math.floor(l[0]/t.length)+a,l[0]%t.length,l[0]%t.length+a)}function Et(t,e){var a=e.reduce((t,e,a)=>(0!=e&&t.push(a),t),[]);return vt(t,Math.floor(a[0]/t.length),Math.floor(a[0]/t.length)+1,a[0]%t.length,a[0]%t.length+1)}function Rt(t){return 150/t>20?20:150/t}function Ct(t){let e=t.map((function(t){return Math.max.apply(Math,t)})),a=Math.max.apply(null,e),l=t.map((function(t){return Math.min.apply(Math,t)})),n=Math.min.apply(null,l);return{range:2*Math.max(Math.abs(n),Math.abs(a)),min:n,max:a}}function St(t,e=Rt(t.length)){for(var a=new Array,l=1,n=1,s=e,r=e,o=0;o<t.length;o++){a.push(new Array);for(var i=0;i<t[0].length;i++)a[o].push({text:Math.round(100*t[o][i])/100,row:o,col:i,x:l,y:n,width:s,height:r}),l+=s;l=1,n+=r}return a}function _t(e){let a;return{c(){a=u("div"),a.innerHTML='<svg id="grid" width="100%" height="100%"></svg>',$(a,"display","inline-block"),$(a,"vertical-align","middle"),f(a,"class","grid")},m(t,l){c(t,a,l),e[10](a)},p:t,i:t,o:t,d(t){t&&g(a),e[10](null)}}}function Nt(t,e,a){let l,{data:n}=e,{highlights:s}=e,{isKernelMath:r}=e,{constraint:o}=e,{dataRange:i}=e,{outputLength:d}=e,{stride:c}=e,{colorScale:g=d3.interpolateRdBu}=e,{isInputLayer:u=!1}=e;const p=E();let h=s,y=n;const m=()=>{d3.select(l).selectAll("#grid > *").remove();const t=n.length*o+2;var e=d3.select(l).select("#grid").attr("width",t+"px").attr("height",t+"px").append("svg").attr("width",t+"px").attr("height",t+"px").selectAll(".row").data(n).enter().append("g").attr("class","row");e.selectAll(".square").data((function(t){return t})).enter().append("rect").attr("class","square").attr("x",(function(t){return t.x})).attr("y",(function(t){return t.y})).attr("width",(function(t){return t.width})).attr("height",(function(t){return t.height})).style("opacity",.8).style("fill",(function(t){let e=t.text;return e=u?1-t.text:(t.text+i/2)/i,g(e)})).on("mouseover",(function(t){n.length!=d?p("message",{hoverH:Math.min(Math.floor(t.row/c),d-1),hoverW:Math.min(Math.floor(t.col/c),d-1)}):p("message",{hoverH:Math.min(Math.floor(t.row/1),d-1),hoverW:Math.min(Math.floor(t.col/1),d-1)})}));if(r)e.selectAll(".text").data((function(t){return t})).enter().append("text").attr("class","text").style("font-size",Math.floor(o/2.6)+"px").attr("x",(function(t){return t.x+t.width/2})).attr("y",(function(t){return t.y+t.height/2})).style("fill",(function(t){let e=t.text;return e=u?1-t.text:(t.text+i/2)/i,e<.2||e>.8?"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(t){return t.text.toString().replace("-","－")}))};return A(()=>{(n!=y&&(m(),y=n),s!=h)&&(d3.select(l).select("#grid").select("svg").selectAll(".square").style("stroke",t=>r||s.length&&s[t.row*n.length+t.col]?"black":null),h=s)}),M(()=>{m()}),t.$$set=t=>{"data"in t&&a(1,n=t.data),"highlights"in t&&a(2,s=t.highlights),"isKernelMath"in t&&a(3,r=t.isKernelMath),"constraint"in t&&a(4,o=t.constraint),"dataRange"in t&&a(5,i=t.dataRange),"outputLength"in t&&a(6,d=t.outputLength),"stride"in t&&a(7,c=t.stride),"colorScale"in t&&a(8,g=t.colorScale),"isInputLayer"in t&&a(9,u=t.isInputLayer)},[l,n,s,r,o,i,d,c,g,u,function(t){C[t?"unshift":"push"](()=>{l=t,a(0,l)})}]}class Ht extends J{constructor(t){super(),U(this,t,Nt,_t,s,{data:1,highlights:2,isKernelMath:3,constraint:4,dataRange:5,outputLength:6,stride:7,colorScale:8,isInputLayer:9})}}function Pt(e){let a,l,n;return{c(){a=u("div"),l=h(),n=u("div"),n.innerHTML='<svg id="grid" width="100%" height="100%"></svg>',f(a,"class","legend"),f(n,"class","grid")},m(t,s){c(t,a,s),e[10](a),c(t,l,s),c(t,n,s),e[11](n)},p:t,i:t,o:t,d(t){t&&g(a),e[10](null),t&&g(l),t&&g(n),e[11](null)}}}function Ot(t,e,a){let l,n,{data:s}=e,{kernel:r}=e,{constraint:o}=e,{dataRange:i}=e,{kernelRange:d}=e,{colorScale:c=d3.interpolateRdBu}=e,{kernelColorScale:g=d3.interpolateBrBG}=e,{isInputLayer:u=!1}=e;const p=Math.floor(o/3);let h=s;const y=()=>{d3.select(l).selectAll("#grid > *").remove();const t=r?s.length*o*2+2:s.length*o+2;var e=d3.select(l).select("#grid").attr("width",t+"px").attr("height",t+"px").append("svg").attr("width",t+"px").attr("height",t+"px").selectAll(".row").data(s).enter().append("g").attr("class","row"),a=e.selectAll(".square").data((function(t){return t})).enter();a.append("rect").attr("class","square").attr("x",(function(t){return 1===t.x?t.x+p:2*t.x+p})).attr("y",(function(t){return 1===t.y?t.y:2*t.y})).attr("width",(function(t){return t.width})).attr("height",(function(t){return t.height})).style("opacity",.5).style("fill",(function(t){let e=t.text;return e=u?1-t.text:(t.text+i/2)/i,c(e)})).style("stroke","black"),a.append("rect").attr("class","square").attr("x",(function(t){return 1===t.x?t.x+p:2*t.x+p})).attr("y",(function(t){return 1===t.y?t.y+t.height:2*t.y+t.height})).attr("width",(function(t){return t.width})).attr("height",(function(t){return t.height/2})).style("opacity",.5).style("fill",(function(t){let e=(r[t.row][t.col].text+d.range/2)/d.range;return g(.6*e+.2)}));var n=e.selectAll(".text").data((function(t){return t})).enter();n.append("text").attr("class","text").style("font-size",Math.floor(o/2.6)+"px").attr("x",(function(t){return 1===t.x?t.x+t.width/2+p:2*t.x+t.width/2+p})).attr("y",(function(t){return 1===t.y?t.y+t.height/2:2*t.y+t.height/2})).style("fill",(function(t){let e=t.text;return e=u?1-t.text:(t.text+i/2)/i,e<.2||e>.8?u&&e<.2?"black":"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(t){return t.text})),n.append("text").attr("class","text").style("font-size",Math.floor(o/2.6)+"px").attr("font-weight",600).attr("x",(function(t){return 1===t.x?t.x+p/2:2*t.x+p/2})).attr("y",(function(t){return 1===t.y?t.y+t.height+t.height/4:2*t.y+t.height+t.height/4})).style("fill","black").style("text-anchor","middle").style("dominant-baseline","middle").text((function(t){return"×"})),n.append("text").attr("class","text").style("font-size",Math.floor(o/2.6)+"px").attr("x",(function(t){return 1===t.x?t.x+t.width/2+p:2*t.x+t.width/2+p})).attr("y",(function(t){return 1===t.y?t.y+t.height+t.height/4:2*t.y+t.height+t.height/4})).style("fill",(function(t){let e=.6*((r[t.row][t.col].text+d.range/2)/d.range)+.2;return e<.2||e>.8?"white":"black"})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(t){return r[t.row][t.col].text})),n.append("text").attr("class","text").style("font-size",Math.floor(o/1.6)+"px").attr("x",(function(t){return 1===t.x?t.x+t.width+t.width/2+p:2*t.x+t.width+t.width/2+p})).attr("y",(function(t){return 1===t.y?t.y+t.height/2:2*t.y+t.height/2})).style("text-anchor","middle").style("dominant-baseline","middle").text((function(t){return t.row==r.length-1&&t.col==r.length-1?"=":"+"}))};return A(()=>{s!=h&&(y(),h=s)}),M(()=>{y()}),t.$$set=t=>{"data"in t&&a(2,s=t.data),"kernel"in t&&a(3,r=t.kernel),"constraint"in t&&a(4,o=t.constraint),"dataRange"in t&&a(5,i=t.dataRange),"kernelRange"in t&&a(6,d=t.kernelRange),"colorScale"in t&&a(7,c=t.colorScale),"kernelColorScale"in t&&a(8,g=t.kernelColorScale),"isInputLayer"in t&&a(9,u=t.isInputLayer)},[l,n,s,r,o,i,d,c,g,u,function(t){C[t?"unshift":"push"](()=>{n=t,a(1,n)})},function(t){C[t?"unshift":"push"](()=>{l=t,a(0,l)})}]}class Bt extends J{constructor(t){super(),U(this,t,Ot,Pt,s,{data:2,kernel:3,constraint:4,dataRange:5,kernelRange:6,colorScale:7,kernelColorScale:8,isInputLayer:9})}}function Xt(t){let e,a,l,n,s,r,o,i,y,m,x,b,$,w,k,I,L,M,A,E,R,C,S,_,N,H=t[2].length+"",P=t[2][0].length+"",O=t[3].length+"",B=t[3][0].length+"";return y=new Ht({props:{data:t[11],highlights:t[7],outputLength:t[3].length,isKernelMath:!1,constraint:Rt(t[2].length),dataRange:t[4],stride:t[0],colorScale:t[5],isInputLayer:t[6]}}),y.$on("message",t[14]),b=new Bt({props:{data:t[9],kernel:t[13],constraint:Rt(t[1].length),dataRange:t[4],kernelRange:Ct(t[1]),colorScale:t[5],isInputLayer:t[6]}}),w=new Ht({props:{data:t[10],highlights:t[8],isKernelMath:!0,constraint:Rt(t[1].length),dataRange:t[4]}}),_=new Ht({props:{data:t[12],highlights:t[8],isKernelMath:!1,outputLength:t[3].length,constraint:Rt(t[3].length),dataRange:t[4],stride:t[0]}}),_.$on("message",t[14]),{c(){e=u("div"),a=u("div"),l=p("Input ("),n=p(H),s=p(", "),r=p(P),o=p(")"),i=h(),V(y.$$.fragment),m=h(),x=u("div"),V(b.$$.fragment),$=h(),V(w.$$.fragment),k=h(),I=u("div"),L=u("div"),M=p("Output ("),A=p(O),E=p(", "),R=p(B),C=p(")"),S=h(),V(_.$$.fragment),f(a,"class","header-text"),f(e,"class","column has-text-centered svelte-gz7a6i"),f(x,"class","column has-text-centered svelte-gz7a6i"),f(L,"class","header-text"),f(I,"class","column has-text-centered svelte-gz7a6i")},m(t,g){c(t,e,g),d(e,a),d(a,l),d(a,n),d(a,s),d(a,r),d(a,o),d(e,i),K(y,e,null),c(t,m,g),c(t,x,g),K(b,x,null),d(x,$),K(w,x,null),c(t,k,g),c(t,I,g),d(I,L),d(L,M),d(L,A),d(L,E),d(L,R),d(L,C),d(I,S),K(_,I,null),N=!0},p(t,[e]){(!N||4&e)&&H!==(H=t[2].length+"")&&v(n,H),(!N||4&e)&&P!==(P=t[2][0].length+"")&&v(r,P);const a={};2048&e&&(a.data=t[11]),128&e&&(a.highlights=t[7]),8&e&&(a.outputLength=t[3].length),4&e&&(a.constraint=Rt(t[2].length)),16&e&&(a.dataRange=t[4]),1&e&&(a.stride=t[0]),32&e&&(a.colorScale=t[5]),64&e&&(a.isInputLayer=t[6]),y.$set(a);const l={};512&e&&(l.data=t[9]),8192&e&&(l.kernel=t[13]),2&e&&(l.constraint=Rt(t[1].length)),16&e&&(l.dataRange=t[4]),2&e&&(l.kernelRange=Ct(t[1])),32&e&&(l.colorScale=t[5]),64&e&&(l.isInputLayer=t[6]),b.$set(l);const s={};1024&e&&(s.data=t[10]),256&e&&(s.highlights=t[8]),2&e&&(s.constraint=Rt(t[1].length)),16&e&&(s.dataRange=t[4]),w.$set(s),(!N||8&e)&&O!==(O=t[3].length+"")&&v(A,O),(!N||8&e)&&B!==(B=t[3][0].length+"")&&v(R,B);const o={};4096&e&&(o.data=t[12]),256&e&&(o.highlights=t[8]),8&e&&(o.outputLength=t[3].length),8&e&&(o.constraint=Rt(t[3].length)),16&e&&(o.dataRange=t[4]),1&e&&(o.stride=t[0]),_.$set(o)},i(t){N||(j(y.$$.fragment,t),j(b.$$.fragment,t),j(w.$$.fragment,t),j(_.$$.fragment,t),N=!0)},o(t){D(y.$$.fragment,t),D(b.$$.fragment,t),D(w.$$.fragment,t),D(_.$$.fragment,t),N=!1},d(t){t&&g(e),W(y),t&&g(m),t&&g(x),W(b),W(w),t&&g(k),t&&g(I),W(_)}}}function Gt(t,e,a){let{stride:l}=e,{dilation:n}=e,{kernel:s}=e,{image:r}=e,{output:o}=e,{isPaused:i}=e,{dataRange:d}=e,{colorScale:c}=e,{isInputInputLayer:g=!1}=e;const u=E();let p=r.length+0,h=[];for(let t=0;t<s.length;t++){h.push([]);for(let e=0;e<s.length;e++)h[t].push(0)}h=St(h);let y,m,f=St([0]),x=[],v=kt(o.length*o.length,t=>!0);function b(t){m=0;let e=Lt(t,o,s.length,p,n);t<=0||(y&&clearInterval(y),a(17,y=setInterval(()=>{if(i)return;const t=m%(o.length*o.length);a(8,v=kt(o.length*o.length,t=>!1));const l=Math.floor(t/o.length),n=t%o.length;a(8,v[l*o.length+n]=!0,v),a(7,x=Mt(l,n,p,s.length,e,s.length));const d=At(r,x,s.length);a(9,h=St(d));const c=Et(o,v);a(10,f=St(c)),m++},250)))}b(l);let $=St(r),w=St(o),k=St(s);return t.$$set=t=>{"stride"in t&&a(0,l=t.stride),"dilation"in t&&a(16,n=t.dilation),"kernel"in t&&a(1,s=t.kernel),"image"in t&&a(2,r=t.image),"output"in t&&a(3,o=t.output),"isPaused"in t&&a(15,i=t.isPaused),"dataRange"in t&&a(4,d=t.dataRange),"colorScale"in t&&a(5,c=t.colorScale),"isInputInputLayer"in t&&a(6,g=t.isInputInputLayer)},t.$$.update=()=>{if(4&t.$$.dirty&&(p=r.length+0),8&t.$$.dirty){kt(o.length*o.length,t=>!0)}15&t.$$.dirty&&(b(l),a(11,$=St(r)),a(12,w=St(o)),a(13,k=St(s)))},[l,s,r,o,d,c,g,x,v,h,f,$,w,k,function(t){let e=Lt(l,o,s.length,p,n);a(8,v=kt(o.length*o.length,t=>!1));const d=t.detail.hoverH,c=t.detail.hoverW;a(8,v[d*o.length+c]=!0,v),a(7,x=Mt(d,c,p,s.length,e,s.length));const g=At(r,x,s.length);a(9,h=St(g));const y=Et(o,v);a(10,f=St(y)),a(15,i=!0),u("message",{text:i})},i,n,y]}class qt extends J{constructor(t){super(),U(this,t,Gt,Xt,s,{stride:0,dilation:16,kernel:1,image:2,output:3,isPaused:15,dataRange:4,colorScale:5,isInputInputLayer:6})}}function zt(t){let e,a,n,s,r,o,i,p,y,x,v,b,$,w,k,I,L,M,A,E=t[6]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return w=new qt({props:{kernel:t[2],image:t[1],output:t[7],stride:Tt,dilation:jt,isPaused:t[6],dataRange:t[3],colorScale:t[4],isInputInputLayer:t[5]}}),w.$on("message",t[9]),{c(){e=u("div"),a=u("div"),n=u("div"),s=u("div"),s.textContent="Convolution",r=h(),o=u("div"),i=u("div"),i.innerHTML='<i class="fas fa-info-circle"></i>',p=h(),y=u("div"),x=h(),v=u("div"),v.innerHTML='<i class="fas control-icon fa-times-circle"></i>',b=h(),$=u("div"),V(w.$$.fragment),k=h(),I=u("div"),I.innerHTML='<img src="/cnn-explainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-1j8mhv0"/> \n        <div class="annotation-text"><span style="font-weight:600">Hover over</span> the matrices to change kernel position.</div>',f(s,"class","title-text svelte-1j8mhv0"),f(i,"class","control-button svelte-1j8mhv0"),f(i,"title","Jump to article section"),f(y,"class","play-button control-button svelte-1j8mhv0"),f(y,"title","Play animation"),f(v,"class","delete-button control-button svelte-1j8mhv0"),f(v,"title","Close"),f(o,"class","buttons svelte-1j8mhv0"),f(n,"class","control-pannel svelte-1j8mhv0"),f($,"class","container is-centered svelte-1j8mhv0"),f(I,"class","annotation svelte-1j8mhv0"),f(a,"class","box svelte-1j8mhv0"),f(e,"class","container svelte-1j8mhv0"),f(e,"id","detailview-container")},m(l,g){c(l,e,g),d(e,a),d(a,n),d(n,s),d(n,r),d(n,o),d(o,i),d(o,p),d(o,y),y.innerHTML=E,d(o,x),d(o,v),d(a,b),d(a,$),K(w,$,null),d(a,k),d(a,I),L=!0,M||(A=[m(i,"click",Dt),m(y,"click",t[8]),m(v,"click",t[10])],M=!0)},p(t,e){(!L||64&e)&&E!==(E=t[6]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(y.innerHTML=E);const a={};4&e&&(a.kernel=t[2]),2&e&&(a.image=t[1]),128&e&&(a.output=t[7]),64&e&&(a.isPaused=t[6]),8&e&&(a.dataRange=t[3]),16&e&&(a.colorScale=t[4]),32&e&&(a.isInputInputLayer=t[5]),w.$set(a)},i(t){L||(j(w.$$.fragment,t),L=!0)},o(t){D(w.$$.fragment,t),L=!1},d(t){t&&g(e),W(w),M=!1,l(A)}}}function Ft(t){let e,a,l=!t[0]&&zt(t);return{c(){l&&l.c(),e=y()},m(t,n){l&&l.m(t,n),c(t,e,n),a=!0},p(t,[a]){t[0]?l&&(F(),D(l,1,1,()=>{l=null}),T()):l?(l.p(t,a),1&a&&j(l,1)):(l=zt(t),l.c(),j(l,1),l.m(e.parentNode,e))},i(t){a||(j(l),a=!0)},o(t){D(l),a=!1},d(t){l&&l.d(t),t&&g(e)}}}let Tt=1;const jt=1;function Dt(){let t=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,e=new SmoothScroll('a[href*="#"]',{offset:-t}),a=document.querySelector("#article-convolution");e.animateScroll(a)}function Vt(t,e,a){let{input:l}=e,{kernel:n}=e,{dataRange:s}=e,{colorScale:r=d3.interpolateRdBu}=e,{isInputInputLayer:o=!1}=e,{isExited:i=!1}=e;const d=E();var c=!1,g=$t(l,n,Tt);return t.$$set=t=>{"input"in t&&a(1,l=t.input),"kernel"in t&&a(2,n=t.kernel),"dataRange"in t&&a(3,s=t.dataRange),"colorScale"in t&&a(4,r=t.colorScale),"isInputInputLayer"in t&&a(5,o=t.isInputInputLayer),"isExited"in t&&a(0,i=t.isExited)},t.$$.update=()=>{if(6&t.$$.dirty)try{a(7,g=$t(l,n,Tt))}catch{console.log("Cannot handle stride of "+Tt)}},[i,l,n,s,r,o,c,g,function(){a(6,c=!c)},function(t){a(6,c=t.detail.text)},function(){a(0,i=!0),d("message",{text:i})}]}class Kt extends J{constructor(t){super(),U(this,t,Vt,Ft,s,{input:1,kernel:2,dataRange:3,colorScale:4,isInputInputLayer:5,isExited:0})}}function Wt(t){let e,a,l,n,s,r,o,i,y,m,x,b,$,w,k,I,L,M,A,E,R,C,S,_,N,H,P,O,B,X=t[0].length+"",G=t[0][0].length+"",q=t[1].length+"",z=t[1][0].length+"";return y=new Ht({props:{data:t[7],highlights:t[3],outputLength:t[1].length,isKernelMath:!1,constraint:Rt(t[0].length),dataRange:t[2],stride:1}}),y.$on("message",t[9]),w=new Ht({props:{data:St([[0]]),highlights:t[4],isKernelMath:!0,constraint:20,dataRange:t[2]}}),I=new Ht({props:{data:t[5],highlights:t[4],isKernelMath:!0,constraint:20,dataRange:t[2]}}),M=new Ht({props:{data:t[6],highlights:t[4],isKernelMath:!0,constraint:20,dataRange:t[2]}}),O=new Ht({props:{data:t[8],highlights:t[4],isKernelMath:!1,outputLength:t[1].length,constraint:Rt(t[1].length),dataRange:t[2],stride:1}}),O.$on("message",t[9]),{c(){e=u("div"),a=u("div"),l=p("Input ("),n=p(X),s=p(", "),r=p(G),o=p(")"),i=h(),V(y.$$.fragment),m=h(),x=u("div"),b=u("span"),$=p("max(\n    "),V(w.$$.fragment),k=p("\n    ,\n    "),V(I.$$.fragment),L=p("\n    )\n    =\n    "),V(M.$$.fragment),A=h(),E=u("div"),R=u("div"),C=p("Output ("),S=p(q),_=p(", "),N=p(z),H=p(")"),P=h(),V(O.$$.fragment),f(a,"class","header-text"),f(e,"class","column has-text-centered svelte-gz7a6i"),f(x,"class","column has-text-centered svelte-gz7a6i"),f(R,"class","header-text"),f(E,"class","column has-text-centered svelte-gz7a6i")},m(t,g){c(t,e,g),d(e,a),d(a,l),d(a,n),d(a,s),d(a,r),d(a,o),d(e,i),K(y,e,null),c(t,m,g),c(t,x,g),d(x,b),d(b,$),K(w,b,null),d(b,k),K(I,b,null),d(b,L),K(M,b,null),c(t,A,g),c(t,E,g),d(E,R),d(R,C),d(R,S),d(R,_),d(R,N),d(R,H),d(E,P),K(O,E,null),B=!0},p(t,[e]){(!B||1&e)&&X!==(X=t[0].length+"")&&v(n,X),(!B||1&e)&&G!==(G=t[0][0].length+"")&&v(r,G);const a={};128&e&&(a.data=t[7]),8&e&&(a.highlights=t[3]),2&e&&(a.outputLength=t[1].length),1&e&&(a.constraint=Rt(t[0].length)),4&e&&(a.dataRange=t[2]),y.$set(a);const l={};16&e&&(l.highlights=t[4]),4&e&&(l.dataRange=t[2]),w.$set(l);const s={};32&e&&(s.data=t[5]),16&e&&(s.highlights=t[4]),4&e&&(s.dataRange=t[2]),I.$set(s);const o={};64&e&&(o.data=t[6]),16&e&&(o.highlights=t[4]),4&e&&(o.dataRange=t[2]),M.$set(o),(!B||2&e)&&q!==(q=t[1].length+"")&&v(S,q),(!B||2&e)&&z!==(z=t[1][0].length+"")&&v(N,z);const i={};256&e&&(i.data=t[8]),16&e&&(i.highlights=t[4]),2&e&&(i.outputLength=t[1].length),2&e&&(i.constraint=Rt(t[1].length)),4&e&&(i.dataRange=t[2]),O.$set(i)},i(t){B||(j(y.$$.fragment,t),j(w.$$.fragment,t),j(I.$$.fragment,t),j(M.$$.fragment,t),j(O.$$.fragment,t),B=!0)},o(t){D(y.$$.fragment,t),D(w.$$.fragment,t),D(I.$$.fragment,t),D(M.$$.fragment,t),D(O.$$.fragment,t),B=!1},d(t){t&&g(e),W(y),t&&g(m),t&&g(x),W(w),W(I),W(M),t&&g(A),t&&g(E),W(O)}}}function Yt(t,e,a){let{image:l}=e,{output:n}=e,{isPaused:s}=e,{dataRange:r}=e;const o=E();let i,d,c=l.length+0,g=St([[0]]),u=St([[0]]),p=kt(l.length*l.length,t=>!0),h=kt(n.length*n.length,t=>!0);function y(){d=0,i&&clearInterval(i),a(11,i=setInterval(()=>{if(s)return;const t=d%(n.length*n.length);a(4,h=kt(n.length*n.length,t=>!1)),a(3,p=kt(l.length*l.length,t=>{}));const e=Math.floor(t/n.length),r=t%n.length;a(4,h[e*n.length+r]=!0,h),a(3,p[e*n.length+r]=!0,p);const o=At(l,p,1);a(5,g=St(o));const i=Et(n,h);a(6,u=St(i)),d++},250))}y();let m=St(l),f=St(n);return t.$$set=t=>{"image"in t&&a(0,l=t.image),"output"in t&&a(1,n=t.output),"isPaused"in t&&a(10,s=t.isPaused),"dataRange"in t&&a(2,r=t.dataRange)},t.$$.update=()=>{if(1&t.$$.dirty&&(c=l.length+0),3&t.$$.dirty){kt(l.length*l.length,t=>!0),kt(n.length*n.length,t=>!0)}3&t.$$.dirty&&(y(),a(7,m=St(l)),a(8,f=St(n)))},[l,n,r,p,h,g,u,m,f,function(t){a(4,h=kt(n.length*n.length,t=>!1));const e=t.detail.hoverH,r=t.detail.hoverW;a(4,h[e*n.length+r]=!0,h),a(3,p=kt(l.length*l.length,t=>{})),a(3,p[e*n.length+r]=!0,p);const i=At(l,p,1);a(5,g=St(i));const d=Et(n,h);a(6,u=St(d)),a(10,s=!0),o("message",{text:s})},s,i]}class Ut extends J{constructor(t){super(),U(this,t,Yt,Wt,s,{image:0,output:1,isPaused:10,dataRange:2})}}function Jt(t){let e,a,n,s,r,o,i,p,y,x,v,b,$,w,k,I,L,M,A,E=t[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return w=new Ut({props:{image:t[0],output:t[1],isPaused:t[4],dataRange:t[2]}}),w.$on("message",t[6]),{c(){e=u("div"),a=u("div"),n=u("div"),s=u("div"),s.textContent="ReLU Activation",r=h(),o=u("div"),i=u("div"),i.innerHTML='<i class="fas fa-info-circle"></i>',p=h(),y=u("div"),x=h(),v=u("div"),v.innerHTML='<i class="fas control-icon fa-times-circle"></i>',b=h(),$=u("div"),V(w.$$.fragment),k=h(),I=u("div"),I.innerHTML='<img src="/cnn-explainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-1lq7956"/> \n        <div class="annotation-text"><span style="font-weight:600">Hover over</span> the matrices to change pixel.</div>',f(s,"class","title-text svelte-1lq7956"),f(i,"class","control-button svelte-1lq7956"),f(i,"title","Jump to article section"),f(y,"class","play-button control-button svelte-1lq7956"),f(y,"title","Play animation"),f(v,"class","delete-button control-button svelte-1lq7956"),f(v,"title","Close"),f(o,"class","buttons svelte-1lq7956"),f(n,"class","control-pannel svelte-1lq7956"),f($,"class","container is-centered is-vcentered svelte-1lq7956"),f(I,"class","annotation svelte-1lq7956"),f(a,"class","box svelte-1lq7956"),f(e,"class","container svelte-1lq7956")},m(l,g){c(l,e,g),d(e,a),d(a,n),d(n,s),d(n,r),d(n,o),d(o,i),d(o,p),d(o,y),y.innerHTML=E,d(o,x),d(o,v),d(a,b),d(a,$),K(w,$,null),d(a,k),d(a,I),L=!0,M||(A=[m(i,"click",Zt),m(y,"click",t[5]),m(v,"click",t[7])],M=!0)},p(t,e){(!L||16&e)&&E!==(E=t[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(y.innerHTML=E);const a={};1&e&&(a.image=t[0]),2&e&&(a.output=t[1]),16&e&&(a.isPaused=t[4]),4&e&&(a.dataRange=t[2]),w.$set(a)},i(t){L||(j(w.$$.fragment,t),L=!0)},o(t){D(w.$$.fragment,t),L=!1},d(t){t&&g(e),W(w),M=!1,l(A)}}}function Qt(t){let e,a,l=!t[3]&&Jt(t);return{c(){l&&l.c(),e=y()},m(t,n){l&&l.m(t,n),c(t,e,n),a=!0},p(t,[a]){t[3]?l&&(F(),D(l,1,1,()=>{l=null}),T()):l?(l.p(t,a),8&a&&j(l,1)):(l=Jt(t),l.c(),j(l,1),l.m(e.parentNode,e))},i(t){a||(j(l),a=!0)},o(t){D(l),a=!1},d(t){l&&l.d(t),t&&g(e)}}}function Zt(){let t=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,e=new SmoothScroll('a[href*="#"]',{offset:-t}),a=document.querySelector("#article-relu");e.animateScroll(a)}function te(t,e,a){let{input:l}=e,{output:n}=e,{dataRange:s}=e,{isExited:r}=e;const o=E();let i=!1;return t.$$set=t=>{"input"in t&&a(0,l=t.input),"output"in t&&a(1,n=t.output),"dataRange"in t&&a(2,s=t.dataRange),"isExited"in t&&a(3,r=t.isExited)},[l,n,s,r,i,function(){a(4,i=!i)},function(t){a(4,i=t.detail.text)},function(){o("message",{text:!0})}]}class ee extends J{constructor(t){super(),U(this,t,te,Qt,s,{input:0,output:1,dataRange:2,isExited:3})}}function ae(t){let e,a,l,n,s,r,o,i,y,m,x,b,$,w,k,I,L,M,A,E,R,C,S,_,N,H,P,O=t[9].length+"",B=t[9][0].length+"",X=t[10].length+"",G=t[10][0].length+"";return y=new Ht({props:{data:t[9],highlights:t[5],outputLength:t[3].length,isKernelMath:!1,constraint:Rt(t[2].length),dataRange:t[4],stride:t[0]}}),y.$on("message",t[11]),w=new Ht({props:{data:t[7],highlights:t[6],isKernelMath:!0,constraint:Rt(t[1]),dataRange:t[4]}}),I=new Ht({props:{data:t[8],highlights:t[6],isKernelMath:!0,constraint:Rt(t[1]),dataRange:t[4]}}),H=new Ht({props:{data:t[10],highlights:t[6],isKernelMath:!1,outputLength:t[3].length,constraint:Rt(t[3].length),dataRange:t[4],stride:t[0]}}),H.$on("message",t[11]),{c(){e=u("div"),a=u("div"),l=p("Input ("),n=p(O),s=p(", "),r=p(B),o=p(")"),i=h(),V(y.$$.fragment),m=h(),x=u("div"),b=u("span"),$=p("max(\n    "),V(w.$$.fragment),k=p("\n    )\n    =\n    "),V(I.$$.fragment),L=h(),M=u("div"),A=u("div"),E=p("Output ("),R=p(X),C=p(", "),S=p(G),_=p(")"),N=h(),V(H.$$.fragment),f(a,"class","header-text"),f(e,"class","column has-text-centered svelte-gz7a6i"),f(x,"class","column has-text-centered svelte-gz7a6i"),f(A,"class","header-text"),f(M,"class","column has-text-centered svelte-gz7a6i")},m(t,g){c(t,e,g),d(e,a),d(a,l),d(a,n),d(a,s),d(a,r),d(a,o),d(e,i),K(y,e,null),c(t,m,g),c(t,x,g),d(x,b),d(b,$),K(w,b,null),d(b,k),K(I,b,null),c(t,L,g),c(t,M,g),d(M,A),d(A,E),d(A,R),d(A,C),d(A,S),d(A,_),d(M,N),K(H,M,null),P=!0},p(t,[e]){(!P||512&e)&&O!==(O=t[9].length+"")&&v(n,O),(!P||512&e)&&B!==(B=t[9][0].length+"")&&v(r,B);const a={};512&e&&(a.data=t[9]),32&e&&(a.highlights=t[5]),8&e&&(a.outputLength=t[3].length),4&e&&(a.constraint=Rt(t[2].length)),16&e&&(a.dataRange=t[4]),1&e&&(a.stride=t[0]),y.$set(a);const l={};128&e&&(l.data=t[7]),64&e&&(l.highlights=t[6]),2&e&&(l.constraint=Rt(t[1])),16&e&&(l.dataRange=t[4]),w.$set(l);const s={};256&e&&(s.data=t[8]),64&e&&(s.highlights=t[6]),2&e&&(s.constraint=Rt(t[1])),16&e&&(s.dataRange=t[4]),I.$set(s),(!P||1024&e)&&X!==(X=t[10].length+"")&&v(R,X),(!P||1024&e)&&G!==(G=t[10][0].length+"")&&v(S,G);const o={};1024&e&&(o.data=t[10]),64&e&&(o.highlights=t[6]),8&e&&(o.outputLength=t[3].length),8&e&&(o.constraint=Rt(t[3].length)),16&e&&(o.dataRange=t[4]),1&e&&(o.stride=t[0]),H.$set(o)},i(t){P||(j(y.$$.fragment,t),j(w.$$.fragment,t),j(I.$$.fragment,t),j(H.$$.fragment,t),P=!0)},o(t){D(y.$$.fragment,t),D(w.$$.fragment,t),D(I.$$.fragment,t),D(H.$$.fragment,t),P=!1},d(t){t&&g(e),W(y),t&&g(m),t&&g(x),W(w),W(I),t&&g(L),t&&g(M),W(H)}}}function le(t,e,a){let{stride:l}=e,{dilation:n}=e,{kernelLength:s}=e,{image:r}=e,{output:o}=e,{isPaused:i}=e,{dataRange:d}=e;const c=E();let g=r.length+0,u=[];for(let t=0;t<s;t++){u.push([]);for(let e=0;e<s;e++)u[t].push(0)}u=St(u);let p,h,y=St([[0]]),m=[],f=kt(o.length*o.length,t=>!0);function x(t){h=0;let e=Lt(t,o,s,g,n);t<=0||(p&&clearInterval(p),a(14,p=setInterval(()=>{if(i)return;const t=h%(o.length*o.length);a(6,f=kt(o.length*o.length,t=>!1));const l=Math.floor(t/o.length),n=t%o.length;a(6,f[l*o.length+n]=!0,f),a(5,m=Mt(l,n,g,0,e,s));const d=At(r,m,s);a(7,u=St(d));const c=Et(o,f);a(8,y=St(c)),h++},250)))}x(l);let v=St(r),b=St(o);return t.$$set=t=>{"stride"in t&&a(0,l=t.stride),"dilation"in t&&a(13,n=t.dilation),"kernelLength"in t&&a(1,s=t.kernelLength),"image"in t&&a(2,r=t.image),"output"in t&&a(3,o=t.output),"isPaused"in t&&a(12,i=t.isPaused),"dataRange"in t&&a(4,d=t.dataRange)},t.$$.update=()=>{if(4&t.$$.dirty&&(g=r.length+0),8&t.$$.dirty){kt(o.length*o.length,t=>!0)}13&t.$$.dirty&&(x(l),a(9,v=St(r)),a(10,b=St(o)))},[l,s,r,o,d,m,f,u,y,v,b,function(t){let e=Lt(l,o,s,g,n);a(6,f=kt(o.length*o.length,t=>!1));const d=t.detail.hoverH,p=t.detail.hoverW;a(6,f[d*o.length+p]=!0,f),a(5,m=Mt(d,p,g,0,e,s));const h=At(r,m,s);a(7,u=St(h));const x=Et(o,f);a(8,y=St(x)),a(12,i=!0),c("message",{text:i})},i,n,p]}class ne extends J{constructor(t){super(),U(this,t,le,ae,s,{stride:0,dilation:13,kernelLength:1,image:2,output:3,isPaused:12,dataRange:4})}}function se(t){let e,a,n,s,r,o,i,p,y,x,v,b,$,w,k,I,L,M,A,E=t[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>';return w=new ne({props:{kernelLength:t[1],image:t[0],output:t[5],stride:oe,dilation:ie,isPaused:t[4],dataRange:t[2]}}),w.$on("message",t[7]),{c(){e=u("div"),a=u("div"),n=u("div"),s=u("div"),s.textContent="Max Pooling",r=h(),o=u("div"),i=u("div"),i.innerHTML='<i class="fas fa-info-circle"></i>',p=h(),y=u("div"),x=h(),v=u("div"),v.innerHTML='<i class="fas control-icon fa-times-circle"></i>',b=h(),$=u("div"),V(w.$$.fragment),k=h(),I=u("div"),I.innerHTML='<img src="/cnn-explainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-kahisg"/> \n          <div class="annotation-text"><span style="font-weight:600">Hover over</span> the matrices to change kernel position.</div>',f(s,"class","title-text svelte-kahisg"),f(i,"class","control-button svelte-kahisg"),f(i,"title","Jump to article section"),f(y,"class","play-button control-button svelte-kahisg"),f(y,"title","Play animation"),f(v,"class","delete-button control-button svelte-kahisg"),f(v,"title","Close"),f(o,"class","buttons svelte-kahisg"),f(n,"class","control-pannel svelte-kahisg"),f($,"class","container is-centered is-vcentered svelte-kahisg"),f(I,"class","annotation svelte-kahisg"),f(a,"class","box svelte-kahisg"),f(e,"class","container svelte-kahisg")},m(l,g){c(l,e,g),d(e,a),d(a,n),d(n,s),d(n,r),d(n,o),d(o,i),d(o,p),d(o,y),y.innerHTML=E,d(o,x),d(o,v),d(a,b),d(a,$),K(w,$,null),d(a,k),d(a,I),L=!0,M||(A=[m(i,"click",de),m(y,"click",t[6]),m(v,"click",t[8])],M=!0)},p(t,e){(!L||16&e)&&E!==(E=t[4]?'<i class="fas fa-play-circle play-icon"></i>':'<i class="fas fa-pause-circle"></i>')&&(y.innerHTML=E);const a={};2&e&&(a.kernelLength=t[1]),1&e&&(a.image=t[0]),32&e&&(a.output=t[5]),16&e&&(a.isPaused=t[4]),4&e&&(a.dataRange=t[2]),w.$set(a)},i(t){L||(j(w.$$.fragment,t),L=!0)},o(t){D(w.$$.fragment,t),L=!1},d(t){t&&g(e),W(w),M=!1,l(A)}}}function re(t){let e,a,l=!t[3]&&se(t);return{c(){l&&l.c(),e=y()},m(t,n){l&&l.m(t,n),c(t,e,n),a=!0},p(t,[a]){t[3]?l&&(F(),D(l,1,1,()=>{l=null}),T()):l?(l.p(t,a),8&a&&j(l,1)):(l=se(t),l.c(),j(l,1),l.m(e.parentNode,e))},i(t){a||(j(l),a=!0)},o(t){D(l),a=!1},d(t){l&&l.d(t),t&&g(e)}}}let oe=2;const ie=1;function de(){let t=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,e=new SmoothScroll('a[href*="#"]',{offset:-t}),a=document.querySelector("#article-pooling");e.animateScroll(a)}function ce(t,e,a){let{input:l}=e,{kernelLength:n}=e,{dataRange:s}=e,{isExited:r}=e;const o=E();var i=!1,d=wt(l);return t.$$set=t=>{"input"in t&&a(0,l=t.input),"kernelLength"in t&&a(1,n=t.kernelLength),"dataRange"in t&&a(2,s=t.dataRange),"isExited"in t&&a(3,r=t.isExited)},t.$$.update=()=>{if(1&t.$$.dirty)try{a(5,d=wt(l))}catch{console.log("Cannot handle stride of "+oe)}},[l,n,s,r,i,d,function(){a(4,i=!i),console.log(i)},function(t){a(4,i=t.detail.text)},function(){o("message",{text:!0})}]}class ge extends J{constructor(t){super(),U(this,t,ce,re,s,{input:0,kernelLength:1,dataRange:2,isExited:3})}}function ue(e){let a,n,s,r,o,i,y,x,b,$,w,k,I,L,M,A,E,R,C;return{c(){var t;a=u("div"),n=u("div"),s=u("div"),r=u("div"),r.innerHTML='<i class="fas fa-info-circle"></i>',o=h(),i=u("div"),i.innerHTML='<i class="fas control-icon fa-times-circle"></i>',y=h(),x=u("div"),b=p("Softmax Score for "),$=u("i"),w=p('"'),k=p(e[0]),I=p('"'),L=h(),t="svg",M=document.createElementNS("http://www.w3.org/2000/svg",t),A=h(),E=u("div"),E.innerHTML='<img src="/cnn-explainer/assets/img/pointer.svg" alt="pointer icon" class="svelte-1uac4ng"/> \n      <div class="annotation-text"><span style="font-weight:600">Hover over</span> the numbers to highlight logit circles.</div>',f(r,"class","control-button svelte-1uac4ng"),f(r,"title","Jump to article section"),f(i,"class","delete-button control-button svelte-1uac4ng"),f(i,"title","Close"),f(s,"class","buttons svelte-1uac4ng"),f(x,"class","title-text svelte-1uac4ng"),f(M,"id","softmax-svg"),f(M,"width","470"),f(M,"height","105"),f(M,"class","svelte-1uac4ng"),f(E,"class","annotation svelte-1uac4ng"),f(n,"class","box svelte-1uac4ng"),f(a,"class","container")},m(t,l){c(t,a,l),d(a,n),d(n,s),d(s,r),d(s,o),d(s,i),d(n,y),d(n,x),d(x,b),d(x,$),d($,w),d($,k),d($,I),d(n,L),d(n,M),d(n,A),d(n,E),e[10](a),R||(C=[m(r,"click",pe),m(i,"click",e[2])],R=!0)},p(t,[e]){1&e&&v(k,t[0])},i:t,o:t,d(t){t&&g(a),e[10](null),R=!1,l(C)}}}function pe(){let t=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,e=new SmoothScroll('a[href*="#"]',{offset:-t}),a=document.querySelector("#article-softmax");e.animateScroll(a)}function he(t,e,a){let l,{logits:n}=e,{logitColors:s}=e,{selectedI:r}=e,{highlightI:o=-1}=e,{outputName:i}=e,{outputValue:d}=e,{startAnimation:c}=e,g=null;const u=E(),p=(t,e)=>void 0===e?d3.format(".2f")(t):d3.format(`.${e}f`)(t),h=(t,e,l,n)=>{a(3,o=n),u("mouseOver",{curI:n})},y=(t,e,l,n)=>{a(3,o=-1),u("mouseLeave",{curI:n})};return M(()=>{a(9,g=d3.select(l).select("#softmax-svg"));let t=g.append("g").attr("class","formula-right").attr("transform","translate(10, 0)").style("font-size","15px"),e=t.append("g").attr("class","denominator").attr("transform","translate(0, 58)");e.append("text").attr("x",0).attr("y",0).style("fill","gray").text("(");let o=8;n.forEach((t,a)=>{a/4>=1&&a%4==0&&(o=8);let l=e.append("text").attr("x",o).attr("y",20*Math.floor(a/4)).style("cursor","crosshair").style("pointer-events","all").on("mouseover",(t,e,l)=>h(0,0,0,a)).on("mouseleave",(t,e,l)=>y(0,0,0,a)).text("exp(");l.append("tspan").attr("class",`formula-term-${a} formula-term`).attr("dx","1").style("fill",s[a]).style("fill-opacity",a===r||c.hasInitialized?1:0).text(p(t)),l.append("tspan").attr("dx","1").text(")");let i=l.node().getBBox();o+=i.width+4,a!==n.length-1?(e.append("text").attr("x",o).attr("y",20*Math.floor(a/4)).text("+"),o+=14):e.append("text").attr("x",o-2).attr("y",20*Math.floor(a/4)).style("fill","gray").text(")")}),e.selectAll("text").data(n).enter().append("text").attr("x",(t,e)=>40*e).attr("y",0).text(t=>p(t));let i=e.node().getBBox();t.append("line").attr("class","separation-line").attr("x1",-5).attr("x2",i.width+5).attr("y1",32).attr("y2",32).style("stroke-width",1.2).style("stroke","gray");let u=t.append("g").attr("class","numerator-group").attr("transform","translate(0, 20)").append("text").attr("x",i.x+i.width/2).attr("y",0).on("mouseover",(t,e,a)=>h(0,0,0,r)).on("mouseleave",(t,e,a)=>y(0,0,0,r)).style("pointer-events","all").style("cursor","crosshair").style("text-anchor","middle").text("exp(");u.append("tspan").attr("class",`formula-term-${r} formula-term`).attr("dx",1).style("fill",s[r]).text(""+p(n[r])),u.append("tspan").attr("dx",1).text(")");let m=g.append("g").attr("class","formula-left").attr("transform","translate(395, 32)");m.append("text").attr("x",20).attr("dominant-baseline","middle").text(""+p(d,4)).node().getBBox();m.append("text").attr("dominant-baseline","middle").attr("x",0).attr("y",0).style("fill","gray").style("font-weight","bold").text("=")}),t.$$set=t=>{"logits"in t&&a(4,n=t.logits),"logitColors"in t&&a(5,s=t.logitColors),"selectedI"in t&&a(6,r=t.selectedI),"highlightI"in t&&a(3,o=t.highlightI),"outputName"in t&&a(0,i=t.outputName),"outputValue"in t&&a(7,d=t.outputValue),"startAnimation"in t&&a(8,c=t.startAnimation)},t.$$.update=()=>{520&t.$$.dirty&&null!==g&&(g.selectAll(".formula-term").style("text-decoration","none").style("font-weight","normal"),g.selectAll(".formula-term-"+o).style("font-weight","bold").style("text-decoration","underline")),768&t.$$.dirty&&null!==g&&g.select(".formula-term-"+c.i).transition("softmax-edge").duration(c.duration).style("fill-opacity",1)},[i,l,()=>{u("xClicked",{})},o,n,s,r,d,c,g,function(t){C[t?"unshift":"push"](()=>{l=t,a(1,l)})}]}class ye extends J{constructor(t){super(),U(this,t,he,ue,s,{logits:4,logitColors:5,selectedI:6,highlightI:3,outputName:0,outputValue:7,startAnimation:8})}}function me(e){let a,n,s,r,o,i,y,x,w,I,L,M,A,E,R,C,S,_,N,H,P,O,B,X,G,q,z,F,T,j,D,V,K,W,Y,U,J,Q=e[5].error+"";return{c(){a=u("div"),n=u("div"),s=u("div"),r=h(),o=u("div"),i=u("header"),y=u("p"),y.textContent="Add Input Image",x=h(),w=u("button"),I=h(),L=u("section"),M=u("div"),A=u("div"),E=u("input"),R=h(),C=u("span"),C.innerHTML='<i class="fas fa-link"></i>',S=h(),_=u("div"),_.textContent="or",N=h(),H=u("div"),P=u("label"),O=u("input"),B=h(),X=u("span"),X.innerHTML='<span class="file-icon"><i class="fas fa-upload"></i></span> \n                <span class="file-label">Upload</span>',G=h(),q=u("footer"),z=u("div"),F=p(Q),T=h(),j=u("div"),D=u("button"),D.textContent="Cancel",V=h(),K=u("button"),K.textContent="Add",W=h(),Y=u("img"),f(s,"class","modal-background"),f(y,"class","modal-card-title svelte-1o5lxfe"),f(w,"class","delete"),f(w,"aria-label","close"),f(i,"class","modal-card-head svelte-1o5lxfe"),f(E,"class","input small-font svelte-1o5lxfe"),f(E,"type","url"),f(E,"placeholder","Paste URL of image..."),f(C,"class","icon small-font is-left svelte-1o5lxfe"),f(A,"class","control has-icons-left svelte-1o5lxfe"),k(A,"is-loading",e[3]),f(_,"class","or-label svelte-1o5lxfe"),f(O,"class","file-input"),f(O,"type","file"),f(O,"name","image"),f(O,"accept",".png,.jpeg,.tiff,.jpg,.png"),f(X,"class","file-cta small-font svelte-1o5lxfe"),f(P,"class","file-label"),f(H,"class","file"),f(M,"class","field svelte-1o5lxfe"),f(L,"class","modal-card-body"),f(z,"class","error-message svelte-1o5lxfe"),k(z,"hidden",!e[5].show),f(D,"class","button is-smaller svelte-1o5lxfe"),f(K,"class","button is-success is-smaller svelte-1o5lxfe"),f(j,"class","button-container"),f(q,"class","modal-card-foot svelte-1o5lxfe"),f(o,"class","modal-card svelte-1o5lxfe"),f(n,"class","modal"),f(n,"id","input-modal"),k(n,"is-active",e[6].show),$(Y,"display","none"),f(Y,"id","vali-image"),f(Y,"alt","hidden image"),f(a,"class","modal-component")},m(t,l){c(t,a,l),d(a,n),d(n,s),d(n,r),d(n,o),d(o,i),d(i,y),d(i,x),d(i,w),d(o,I),d(o,L),d(L,M),d(M,A),d(A,E),b(E,e[2]),d(A,R),d(A,C),d(M,S),d(M,_),d(M,N),d(M,H),d(H,P),d(P,O),d(P,B),d(P,X),d(o,G),d(o,q),d(q,z),d(z,F),d(q,T),d(q,j),d(j,D),d(j,V),d(j,K),d(a,W),d(a,Y),e[14](Y),e[15](a),U||(J=[m(s,"click",e[10]),m(w,"click",e[10]),m(E,"input",e[12]),m(O,"change",e[13]),m(O,"change",e[9]),m(D,"click",e[10]),m(K,"click",e[11]),m(Y,"error",e[7]),m(Y,"load",e[8])],U=!0)},p(t,[e]){4&e&&E.value!==t[2]&&b(E,t[2]),8&e&&k(A,"is-loading",t[3]),32&e&&Q!==(Q=t[5].error+"")&&v(F,Q),32&e&&k(z,"hidden",!t[5].show),64&e&&k(n,"is-active",t[6].show)},i:t,o:t,d(t){t&&g(a),e[14](null),e[15](null),U=!1,l(J)}}}function fe(t,e,a){let l,n,s,r="",o=!1,i=!0,d={show:!1,error:""};const c=E();let g={show:!1};yt.set(g),yt.subscribe(t=>{a(6,g=t)});return M(()=>{d3.select(l).select("#input-modal")}),[l,n,r,o,s,d,g,()=>{a(3,o=!1),a(5,d.show=!0,d),a(5,d.error=i?"We can't find the image at that URL.":"Not a valid image file.",d)},()=>{let t=document.createElement("canvas"),e=t.getContext("2d");t.width=n.width,t.height=n.height,e.drawImage(n,0,0);try{e.getImageData(0,0,n.width,n.height),a(3,o=!1),a(6,g.show=!1,g),yt.set(g),c("urlTyped",{url:n.src}),a(2,r=null)}catch(t){a(3,o=!1),a(5,d.show=!0,d),a(5,d.error="No permission to load this image.",d)}},()=>{i=!1;let t=new FileReader;t.onload=t=>{a(1,n.src=t.target.result,n)},t.readAsDataURL(s[0])},()=>{a(6,g.show=!1,g),yt.set(g),c("xClicked",{preImage:g.preImage})},()=>{a(3,o=!0),a(5,d.show=!1,d),a(1,n.crossOrigin="Anonymous",n),a(1,n.src=r,n)},function(){r=this.value,a(2,r)},function(){s=this.files,a(4,s)},function(t){C[t?"unshift":"push"](()=>{n=t,a(1,n)})},function(t){C[t?"unshift":"push"](()=>{l=t,a(0,l)})}]}class xe extends J{constructor(t){super(),U(this,t,fe,me,s,{})}}var ve=document.createElement("script");ve.src="https://www.youtube.com/iframe_api";var be=document.getElementsByTagName("script")[0];function $e(e){let a;return{c(){a=u("body")},m(t,e){c(t,a,e)},p:t,i:t,o:t,d(t){t&&g(a)}}}function we(t){return[]}be.parentNode.insertBefore(ve,be),window.onYouTubeIframeAPIReady=()=>window.dispatchEvent(new Event("iframeApiReady"));class ke extends J{constructor(t){super(),U(this,t,we,$e,s,{})}}const Ie="input",Le="conv",Me="pool",Ae="relu",Ee="fc",Re="flatten";class Ce{constructor(t,e,a,l,n){this.layerName=t,this.index=e,this.type=a,this.bias=l,this.output=n,this.inputLinks=[],this.outputLinks=[]}}class Se{constructor(t,e,a){this.source=t,this.dest=e,this.weight=a}}const _e=async(t,e)=>{let a=await He(t,!0),l=tf.stack([a]),n=[];for(let t=0;t<e.layers.length;t++){let a=e.layers[t].apply(l),s=a.squeeze();3===s.shape.length&&(s=s.transpose([2,0,1])),n.push(s),l=a}return((t,e,a)=>{let l=[],n=[],s=e.layers[0].batchInputShape.slice(1),r=a.transpose([2,0,1]).arraySync();for(let t=0;t<s[2];t++){let e=new Ce("input",t,Ie,0,r[t]);n.push(e)}l.push(n);let o=1;for(let a=0;a<e.layers.length;a++){let n=e.layers[a],s=t[a].squeeze();s=s.arraySync();let r,i=[];switch(n.name.includes("conv")?r=Le:n.name.includes("pool")?r=Me:n.name.includes("relu")?r=Ae:n.name.includes("output")?r=Ee:n.name.includes("flatten")?r=Re:console.log("Find unknown type"),r){case Le:{let t=n.bias.val.arraySync(),e=n.kernel.val.transpose([3,2,0,1]).arraySync();for(let a=0;a<s.length;a++){let d=new Ce(n.name,a,r,t[a],s[a]);for(let t=0;t<l[o-1].length;t++){let n=l[o-1][t],s=new Se(n,d,e[a][t]);n.outputLinks.push(s),d.inputLinks.push(s)}i.push(d)}break}case Ee:{let t=n.bias.val.arraySync(),e=n.kernel.val.transpose([1,0]).arraySync();for(let a=0;a<s.length;a++){let d=new Ce(n.name,a,r,t[a],s[a]),c=0;for(let t=0;t<l[o-1].length;t++){let n=l[o-1][t],s=new Se(n,d,e[a][t]);n.outputLinks.push(s),d.inputLinks.push(s),c+=n.output*e[a][t]}c+=t[a],d.logit=c,i.push(d)}l[o-1].sort((t,e)=>t.realIndex-e.realIndex);break}case Ae:case Me:{let t=0,e=null;for(let a=0;a<s.length;a++){let d=new Ce(n.name,a,r,t,s[a]),c=l[o-1][a],g=new Se(c,d,e);c.outputLinks.push(g),d.inputLinks.push(g),i.push(d)}break}case Re:{let t=0;for(let e=0;e<s.length;e++){let a=l[o-1][0].output.length,d=l[o-1].length,c=e%d,g=Math.floor(Math.floor(e/d)/a),u=Math.floor(e/d)%a,p=c*(a*a)+g*a+u,h=new Ce(n.name,e,r,t,s[e]);h.realIndex=p;let y=new Se(l[o-1][c],h,[g,u]);l[o-1][c].outputLinks.push(y),h.inputLinks.push(y),i.push(h)}i.sort((t,e)=>t.index-e.index);break}default:console.error("Encounter unknown layer type")}l.push(i),o++}return l})(n,e,a)},Ne=(t,e,a,l=!0)=>{let n=tf.fill([e,a,3],0).arraySync();for(let s=0;s<t.length;s++){let r=Math.floor(s/4),o=s%4,i=e===a?Math.floor(r/e):r%e,d=e===a?r%e:Math.floor(r/e);if(o<3){let e=t[s];l&&(e/=255),n[i][d][o]=e}}return 64!=e&&64!=a&&(n=(t=>{let e,a=t.length,l=t[0].length;if(a<64||l<64){let e=Math.min(a,l),n=Math.floor(a/2)-e/2,s=Math.floor(l/2)-e/2;t.slice(n,n+e).map(t=>t.slice(s,s+e))}else{let n=Math.floor(a/2)-Math.floor(32),s=Math.floor(l/2)-Math.floor(32);e=t.slice(n,n+64).map(t=>t.slice(s,s+64))}return e})(n)),tf.tensor3d(n)},He=(t,e=!0)=>{let a=document.createElement("canvas");a.style.cssText="display:none;",document.getElementsByTagName("body")[0].appendChild(a);let l=a.getContext("2d");return new Promise((n,s)=>{let r,o=new Image;o.crossOrigin="Anonymous",o.src=t,o.onload=()=>{if(a.width=o.width,a.height=o.height,o.width>64||o.height>64){let t=document.createElement("canvas"),e=t.getContext("2d");const a=65/Math.min(o.width,o.height);t.width=o.width*a,t.height=o.height*a,e.drawImage(o,0,0,t.width,t.height),o.width!=o.height&&(l.translate(t.width,0),l.scale(-1,1),l.translate(t.width/2,t.height/2),l.rotate(90*Math.PI/180)),o.width!=o.height?l.drawImage(t,-t.width/2,-t.height/2):l.drawImage(t,0,0),r=l.getImageData(0,0,t.width,t.height)}else l.drawImage(o,0,0),r=l.getImageData(0,0,o.width,o.height);let t=r.data,s=r.width,i=r.height;a.parentNode.removeChild(a),n(Ne(t,s,i,e))},o.onerror=s})};const Pe={nodeLength:40,plusSymbolRadius:8,numLayers:12,edgeOpacity:.8,edgeInitColor:"rgb(230, 230, 230)",edgeHoverColor:"rgb(130, 130, 130)",edgeHoverOuting:!1,edgeStrokeWidth:.7,intermediateColor:"gray",layerColorScales:{input:[d3.interpolateGreys,d3.interpolateGreys,d3.interpolateGreys],conv:d3.interpolateRdBu,relu:d3.interpolateRdBu,pool:d3.interpolateRdBu,fc:d3.interpolateGreys,weight:d3.interpolateBrBG,logit:d3.interpolateOranges},svgPaddings:{top:25,bottom:25,left:50,right:50},kernelRectLength:8/3,gapRatio:4,overlayRectOffset:12,classLists:["Rettungsboot","Marienkäfer","Pizza","Paprika","Schulbus","Koala","Kaffee","Pandabär","Orange","Rennauto"]},Oe=Pe.nodeLength,Be=t=>{let e=1/0,a=-1/0;if(void 0===t.length)return[t,t];if(void 0===t[0].length){for(let l=0;l<t[0].length;l++)t[l]<e?e=t[l]:t[l]>a&&(a=t[l]);return[e,a]}for(let l=0;l<t.length;l++)for(let n=0;n<t[0].length;n++)t[l][n]<e?e=t[l][n]:t[l][n]>a&&(a=t[l][n]);return[e,a]},Xe=t=>({x:t.x+Oe,y:t.y+Oe/2}),Ge=t=>({x:t.x,y:t.y+Oe/2}),qe=(t,e,a,l)=>(void 0===l&&(l=0),t((a+e/2)/e*(1-2*l)+l)),ze=Pe.layerColorScales,Fe=Pe.nodeLength,Te=Pe.numLayers,je=Pe.edgeOpacity,De=Pe.edgeInitColor,Ve=Pe.edgeStrokeWidth,Ke=Pe.svgPaddings,We=Pe.gapRatio,Ye=Pe.classLists,Ue=d3.format(".4f");let Je=void 0;et.subscribe(t=>{Je=t});let Qe=void 0;at.subscribe(t=>{Qe=t});let Ze=void 0;lt.subscribe(t=>{Ze=t});let ta=void 0;tt.subscribe(t=>{ta=t});let ea=void 0;nt.subscribe(t=>{ea=t});let aa=void 0;st.subscribe(t=>{aa=t});let la=void 0;rt.subscribe(t=>{la=t});let na=void 0;ot.subscribe(t=>{na=t});let sa=void 0;dt.subscribe(t=>{sa=t});const ra=(t,e,a,l)=>{let n=a[e],s=ze[t.type];"input"===t.type&&(s=s[t.index]);let r=void 0===t.output.length?1:t.output.length,o=document.createElement("canvas"),i=o.getContext("2d");o.width=r,o.height=r;let d=i.getImageData(0,0,r,r),c=d.data;if(1===r)c[0]=t.output;else for(let e=0;e<c.length;e+=4){let a=Math.floor(e/4),n=Math.floor(a/r),o=a%r,i=void 0;i="input"===t.type||"fc"===t.type?d3.rgb(s(1-t.output[n][o])):d3.rgb(s((t.output[n][o]+l/2)/l)),c[e]=i.r,c[e+1]=i.g,c[e+2]=i.b,c[e+3]=255}let g=document.createElement("canvas");g.width=3*Fe,g.height=3*Fe;let u=g.getContext("2d");i.putImageData(d,0,0),u.drawImage(o,0,0,r,r,0,0,3*Fe,3*Fe);let p=g.toDataURL();d3.select(n).attr("xlink:href",p),o.remove(),g.remove()},oa=(t,e,a,l)=>{d3.select(a[e]).select("rect.output-rect").transition("output").delay(500).duration(800).ease(d3.easeCubicIn).attr("width",l(t.output))},ia=(t,e,a,l,n)=>{void 0===l&&(l=0),void 0===n&&(n=1);let s=t.append("defs").append("svg:linearGradient").attr("id",""+a).attr("x1","0%").attr("y1","100%").attr("x2","100%").attr("y2","100%").attr("spreadMethod","pad");for(let t=0;t<10;t++){let a=t/9,r=e(a*(n-l)+l);s.append("stop").attr("offset",100*a+"%").attr("stop-color",r).attr("stop-opacity",1)}},da=(t,e,a,l,n,s)=>{Ze=(t-Fe*Te)/(8+5*We),lt.set(Ze);let r=0;for(let t=0;t<ta.length;t++){let o=ta[t],i="output"===o[0].layerName;ea.push([]),i||"conv"===o[0].type?r+=Ze*We:r+=Ze;let d=r,c=a.append("g").attr("class","cnn-layer-group").attr("id","cnn-layer-group-"+t);Qe=(e-Fe*o.length)/(o.length+1),at.set(Qe);let g=c.selectAll("g.node-group").data(o,t=>t.index).enter().append("g").attr("class","node-group").style("cursor","pointer").style("pointer-events","all").on("click",s).on("mouseover",l).on("mouseleave",n).classed("node-output",i).attr("id",(e,a)=>{let l=a*Fe+(a+1)*Qe;return l+=Ke.top,ea[t].push({x:d,y:l}),`layer-${t}-node-${a}`});c.selectAll("g.node-output").on("mouseover",(t,e,a)=>{l(t,e,a),ht.set({show:!0,text:"Output value: "+Ue(t.output)})}).on("mouseleave",(t,e,a)=>{n(t,e,a),ht.set({show:!1,text:"Output value: "+Ue(t.output)})}),"output"!==o[0].layerName?(g.append("image").attr("class","node-image").attr("width",Fe).attr("height",Fe).attr("x",d).attr("y",(e,a)=>ea[t][a].y),g.append("rect").attr("class","bounding").attr("width",Fe).attr("height",Fe).attr("x",d).attr("y",(e,a)=>ea[t][a].y).style("fill","none").style("stroke","gray").style("stroke-width",1).classed("hidden",!0)):(g.append("rect").attr("class","output-rect").attr("x",d).attr("y",(e,a)=>ea[t][a].y+Fe/2+8).attr("height",Fe/4).attr("width",0).style("fill","gray"),g.append("text").attr("class","output-text").attr("x",d).attr("y",(e,a)=>ea[t][a].y+Fe/2).style("dominant-baseline","middle").style("font-size","16px").style("fill","black").style("opacity",.5).text((t,e)=>Ye[e])),r+=Fe}nt.set(ea);let o=d3.scaleLinear().domain(la.output).range([0,Fe]);for(let t=0;t<ta.length;t++){let e=la[aa][t];Je.select("g#cnn-layer-group-"+t).selectAll("image.node-image").each((t,a,l)=>ra(t,a,l,e))}Je.selectAll("g.node-output").each((t,e,a)=>oa(t,e,a,o));let i=ta.map(t=>"output"===t[0].layerName?{name:t[0].layerName,dimension:`(${t.length})`}:{name:t[0].layerName,dimension:`(${t[0].output.length}, ${t[0].output.length}, ${t.length})`}),d=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,c=new SmoothScroll('a[href*="#"]',{offset:-d}),g=Je.selectAll("g.layer-detailed-label").data(i).enter().append("g").attr("class","layer-detailed-label").attr("id",(t,e)=>"layer-detailed-label-"+e).classed("hidden",!sa).attr("transform",(t,e)=>`translate(${ea[e][0].x+Fe/2}, ${(Ke.top+Qe)/2-6})`).style("cursor",t=>t.name.includes("output")?"default":"help").on("click",t=>{let e="";t.name.includes("conv")&&(e="convolution"),t.name.includes("relu")&&(e="relu"),t.name.includes("max_pool")&&(e="pooling"),t.name.includes("input")&&(e="input");let a=document.querySelector("#article-"+e);c.animateScroll(a)});g.append("title").text("Move to article section"),g.append("text").style("opacity",.7).style("dominant-baseline","middle").append("tspan").style("font-size","12px").text(t=>t.name).append("tspan").style("font-size","8px").style("font-weight","normal").attr("x",0).attr("dy","1.5em").text(t=>t.dimension);let u=Je.selectAll("g.layer-label").data(i).enter().append("g").attr("class","layer-label").attr("id",(t,e)=>"layer-label-"+e).classed("hidden",sa).attr("transform",(t,e)=>`translate(${ea[e][0].x+Fe/2}, ${(Ke.top+Qe)/2+5})`).style("cursor",t=>t.name.includes("output")?"default":"help").on("click",t=>{let e="";t.name.includes("conv")&&(e="convolution"),t.name.includes("relu")&&(e="relu"),t.name.includes("max_pool")&&(e="pooling"),t.name.includes("input")&&(e="input");let a=document.querySelector("#article-"+e);c.animateScroll(a)});u.append("title").text("Move to article section"),u.append("text").style("dominant-baseline","middle").style("opacity",.8).text(t=>t.name.includes("conv")?"conv":t.name.includes("relu")?"relu":t.name.includes("max_pool")?"max_pool":t.name),ia(Je,ze.conv,"convGradient"),ia(Je,ze.input[0],"inputGradient");((t,e)=>{for(let a=0;a<2;a++){let l=1+5*a,n=la.local[l],s=la.local[l+2],r=d3.scaleLinear().range([0,2*Fe+Ze-1.2]).domain([-n/2,n/2]),o=d3.scaleLinear().range([0,3*Fe+2*Ze-1.2]).domain([-s/2,s/2]),i=d3.axisBottom().scale(r).tickFormat(d3.format(".2f")).tickValues([-n/2,0,n/2]),d=d3.axisBottom().scale(o).tickFormat(d3.format(".2f")).tickValues([-s/2,0,s/2]),c=t.append("g").attr("class","legend local-legend").attr("id",`local-legend-${a}-1`).classed("hidden",!sa||"local"!==aa).attr("transform",`translate(${ea[l][0].x}, 0)`);c.append("g").attr("transform",`translate(0, ${e-3})`).call(i),c.append("rect").attr("width",2*Fe+Ze).attr("height",e).style("fill","url(#convGradient)");let g=t.append("g").attr("class","legend local-legend").attr("id",`local-legend-${a}-2`).classed("hidden",!sa||"local"!==aa).attr("transform",`translate(${ea[l+2][0].x}, 0)`);g.append("g").attr("transform",`translate(0, ${e-3})`).call(d),g.append("rect").attr("width",3*Fe+2*Ze).attr("height",e).style("fill","url(#convGradient)")}for(let a=0;a<2;a++){let l=1+5*a,n=la.module[l],s=d3.scaleLinear().range([0,5*Fe+3*Ze+1*Ze*We-1.2]).domain([-n/2,n/2]),r=d3.axisBottom().scale(s).tickFormat(d3.format(".2f")).tickValues([-n/2,-n/4,0,n/4,n/2]),o=t.append("g").attr("class","legend module-legend").attr("id","module-legend-"+a).classed("hidden",!sa||"module"!==aa).attr("transform",`translate(${ea[l][0].x}, 0)`);o.append("g").attr("transform",`translate(0, ${e-3})`).call(r),o.append("rect").attr("width",5*Fe+3*Ze+1*Ze*We).attr("height",e).style("fill","url(#convGradient)")}let a=la.global[1],l=d3.scaleLinear().range([0,10*Fe+6*Ze+3*Ze*We-1.2]).domain([-a/2,a/2]),n=d3.axisBottom().scale(l).tickFormat(d3.format(".2f")).tickValues([-a/2,-a/4,0,a/4,a/2]),s=t.append("g").attr("class","legend global-legend").attr("id","global-legend").classed("hidden",!sa||"global"!==aa).attr("transform",`translate(${ea[1][0].x}, 0)`);s.append("g").attr("transform",`translate(0, ${e-3})`).call(n),s.append("rect").attr("width",10*Fe+6*Ze+3*Ze*We).attr("height",e).style("fill","url(#convGradient)");let r=d3.scaleLinear().domain(la.output).range([0,Fe-1.2]),o=d3.axisBottom().scale(r).tickFormat(d3.format(".1f")).tickValues([0,la.output[1]]),i=t.append("g").attr("class","legend output-legend").attr("id","output-legend").classed("hidden",!sa).attr("transform",`translate(${ea[11][0].x}, 0)`);i.append("g").attr("transform",`translate(0, ${e-3})`).call(o),i.append("rect").attr("width",Fe).attr("height",e).style("fill","gray");let d=d3.scaleLinear().range([0,Fe-1.2]).domain([0,1]),c=d3.axisBottom().scale(d).tickFormat(d3.format(".1f")).tickValues([0,.5,1]),g=t.append("g").attr("class","legend input-legend").classed("hidden",!sa).attr("transform",`translate(${ea[0][0].x}, 0)`);g.append("g").attr("transform",`translate(0, ${e-3})`).call(c),g.append("rect").attr("x",.3).attr("width",Fe-.3).attr("height",e).attr("transform",`rotate(180, ${Fe/2}, ${e/2})`).style("stroke","rgb(20, 20, 20)").style("stroke-width",.3).style("fill","url(#inputGradient)")})(Je.append("g").attr("class","color-legend").attr("transform",`translate(0, ${Ke.top+10*Qe+Qe+10*Fe})`),5);let p=d3.linkHorizontal().x(t=>t.x).y(t=>t.y),h=((t,e)=>{let a=[];for(let l=1;l<e.length;l++)for(let n=0;n<e[l].length;n++){let s="output"===e[l][n].layerName,r=Ge(t[l][n]);for(let o=0;o<e[l][n].inputLinks.length;o++){let i=e[l][n].inputLinks[o].source.index;if(s){let t=e[l-1][0].output.length*e[l-1][0].output.length;if(i%t!=0)continue;i=Math.floor(i/t)}let d=Xe(t[l-1][i]),c=e[l][n].inputLinks[o].weight;a.push({source:d,target:r,weight:c,targetLayerIndex:l,targetNodeIndex:n,sourceNodeIndex:i})}}return a})(ea,ta);a.append("g").attr("class","edge-group").selectAll("path.edge").data(h).enter().append("path").attr("class",t=>`edge edge-${t.targetLayerIndex} edge-${t.targetLayerIndex}-${t.targetNodeIndex}`).attr("id",t=>`edge-${t.targetLayerIndex}-${t.targetNodeIndex}-${t.sourceNodeIndex}`).attr("d",t=>p({source:t.source,target:t.target})).style("fill","none").style("stroke-width",Ve).style("opacity",je).style("stroke",De);let y=a.append("g").attr("class","input-annotation"),m=y.append("text").attr("x",ea[0][0].x+Fe/2).attr("y",ea[0][0].y+Fe+5).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");m.append("tspan").style("dominant-baseline","hanging").style("fill","#C95E67").text("Roter"),m.append("tspan").style("dominant-baseline","hanging").text(" Kanal"),y.append("text").attr("x",ea[0][1].x+Fe/2).attr("y",ea[0][1].y+Fe+5).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle").style("fill","#3DB665").text("Grün"),y.append("text").attr("x",ea[0][2].x+Fe/2).attr("y",ea[0][2].y+Fe+5).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle").style("fill","#3F7FBC").text("Blau")},ca=()=>{let t=d3.scaleLinear().domain(la.output).range([0,Fe]);for(let e=0;e<ta.length;e++){let a=ta[e],l=la[aa][e],n=Je.select("g#cnn-layer-group-"+e).selectAll("g.node-group").data(a);e<ta.length-1?n.transition("disappear").duration(300).ease(d3.easeCubicOut).style("opacity",0).on("end",(function(){d3.select(this).select("image.node-image").each((t,e,a)=>ra(t,e,a,l)),d3.select(this).transition("appear").duration(700).ease(d3.easeCubicIn).style("opacity",1)})):n.each((e,a,l)=>oa(e,a,l,t))}for(let t=0;t<2;t++){let e=1+5*t,a=la.local[e],l=la.local[e+2],n=d3.scaleLinear().range([0,2*Fe+Ze]).domain([-a/2,a/2]),s=d3.scaleLinear().range([0,3*Fe+2*Ze]).domain([-l/2,l/2]),r=d3.axisBottom().scale(n).tickFormat(d3.format(".2f")).tickValues([-a/2,0,a/2]),o=d3.axisBottom().scale(s).tickFormat(d3.format(".2f")).tickValues([-l/2,0,l/2]);Je.select(`g#local-legend-${t}-1`).select("g").call(r),Je.select(`g#local-legend-${t}-2`).select("g").call(o)}for(let t=0;t<2;t++){let e=1+5*t,a=la.local[e],l=d3.scaleLinear().range([0,5*Fe+3*Ze+1*Ze*We-1.2]).domain([-a,a]),n=d3.axisBottom().scale(l).tickFormat(d3.format(".2f")).tickValues([-a,-a/2,0,a/2,a]);Je.select("g#module-legend-"+t).select("g").call(n)}let e=la.global[1],a=d3.scaleLinear().range([0,10*Fe+6*Ze+3*Ze*We-1.2]).domain([-e,e]),l=d3.axisBottom().scale(a).tickFormat(d3.format(".2f")).tickValues([-e,-e/2,0,e/2,e]);Je.select("g#global-legend").select("g").call(l);let n=d3.axisBottom().scale(t).tickFormat(d3.format(".1f")).tickValues([0,la.output[1]]);Je.select("g#output-legend").select("g").call(n)},ga=()=>{let t=[1],e=void 0;na=[];for(let a=0;a<ta.length-1;a++){let l=ta[a],n=l.map(t=>Be(t.output)).reduce((t,e)=>[Math.min(t[0],e[0]),Math.max(t[1],e[1])]);na.push({min:n[0],max:n[1]}),"conv"!==l[0].type&&"fc"!==l[0].type||(n=n.map(Math.abs),e=2*(.1+Math.round(1e3*Math.max(...n))/1e3)),void 0!==e&&t.push(e)}t.push(1),na.push({min:0,max:1});let a=[1],l=(Te-2)/5;for(let e=0;e<l;e++){let l=t.slice(1+5*e,1+5*e+5),n=Math.max(...l);for(let t=0;t<5;t++)a.push(n)}a.push(1);let n=[1],s=Math.max(...t.slice(1,t.length-1));for(let t=0;t<Te-2;t++)n.push(s);n.push(1),la.local=t,la.module=a,la.global=n,la.output=[0,d3.max(ta[ta.length-1].map(t=>t.output))],rt.set(la),ot.set(na)},ua=Pe.layerColorScales,pa=Pe.nodeLength,ha=Pe.intermediateColor,ya=Pe.svgPaddings;let ma=void 0;et.subscribe(t=>{ma=t});let fa=void 0;at.subscribe(t=>{fa=t});const xa=t=>{let e=t.layerIndex,a=t.targetX,l=t.disable,n=t.delay,s=t.opacity,r=t.specialIndex,o=t.onEndFunc,i=void 0===t.transitionName?"move":t.transitionName,d=void 0===t.duration?500:t.duration;ma.select("g#cnn-layer-group-"+e).selectAll("g.node-group").each((t,e,o)=>{d3.select(o[e]).style("cursor",l&&e!==r?"default":"pointer").style("pointer-events",l&&e!==r?"none":"all").select("image").transition(i).ease(d3.easeCubicInOut).delay(n).duration(d).attr("x",a),d3.select(o[e]).select("rect.bounding").transition(i).ease(d3.easeCubicInOut).delay(n).duration(d).attr("x",a),void 0!==s&&e!==r&&d3.select(o[e]).select("image").style("opacity",s)}),ma.selectAll("g#layer-label-"+e).transition(i).ease(d3.easeCubicInOut).delay(n).duration(d).attr("transform",()=>`translate(${a+pa/2}, ${(ya.top+fa)/2+5})`).on("end",o),ma.selectAll("g#layer-detailed-label-"+e).transition(i).ease(d3.easeCubicInOut).delay(n).duration(d).attr("transform",()=>`translate(${a+pa/2}, ${(ya.top+fa)/2-6})`).on("end",o)},va=(t,e,a)=>{void 0===a&&(a=ma);let l=a.append("defs").attr("class","overlay-gradient").append("linearGradient").attr("id",t).attr("x1","0%").attr("x2","100%").attr("y1","100%").attr("y2","100%");e.forEach(t=>{l.append("stop").attr("offset",t.offset).attr("stop-color",t.color).attr("stop-opacity",t.opacity)})},ba=t=>{let e=t.legendHeight,a=t.curLayerIndex,l=t.range,n=t.group,s=t.minMax,r=t.width,o=t.x,i=t.y,d=t.isInput,c=t.colorScale,g=t.gradientAppendingName,u=t.gradientGap;void 0===c&&(c=ua.conv),void 0===u&&(u=0);let p="url(#inputGradient)",h=t=>c(t*(1-2*u)+u);if(!d){let t=(s.min+l/2)/l,e=(0+l/2)/l,a=(s.max+l/2)/l,r=s.max-s.min,o=(0-s.min)/r,i=t+(e-t)/2,d=e+(a-e)/2,c=[{offset:0,color:h(t),opacity:1},{offset:o/2,color:h(i),opacity:1},{offset:o,color:h(e),opacity:1},{offset:o+(1-e)/2,color:h(d),opacity:1},{offset:1,color:h(a),opacity:1}];void 0===g?(va("intermediate-legend-gradient",c,n),p="url(#intermediate-legend-gradient)"):(va(""+g,c,n),p=`url(#${g})`)}let y=d3.scaleLinear().range([0,r-1.2]).domain(d?[0,l]:[s.min,s.max]),m=d3.axisBottom().scale(y).tickFormat(d3.format(d?"d":".2f")).tickValues(d?[0,l]:[s.min,0,s.max]),f=n.append("g").attr("class","intermediate-legend-"+(a-1)).attr("transform",`translate(${o}, ${i})`),x=f.append("g").attr("transform",`translate(0, ${e-3})`).call(m);x.selectAll("text").style("font-size","9px").style("fill",ha),x.selectAll("path, line").style("stroke",ha),f.append("rect").attr("width",r).attr("height",e).attr("transform",`rotate(${d?180:0},\n      ${r/2}, ${e/2})`).style("fill",p)},$a=t=>{let e=t.group,a=t.sx,l=t.sy,n=t.tx,s=t.ty,r=t.dr,o=t.hFlip,i=void 0===t.marker?"marker":t.marker;e.append("g").attr("class","arrow-group").append("path").attr("d",`M${a},${l}A${r},${r} 0 0,${o?0:1} ${n},${s}`).attr("marker-end",`url(#${i})`).style("stroke","gray").style("fill","none")},wa=Pe.layerColorScales,ka=Pe.nodeLength,Ia=Pe.plusSymbolRadius,La=Pe.numLayers,Ma=Pe.intermediateColor,Aa=Pe.kernelRectLength,Ea=Pe.svgPaddings,Ra=Pe.gapRatio,Ca=Pe.overlayRectOffset,Sa=d3.format(".4f");let _a=!1,Na=void 0;et.subscribe(t=>{Na=t});let Ha=void 0;at.subscribe(t=>{Ha=t});let Pa=void 0;lt.subscribe(t=>{Pa=t});let Oa=void 0;tt.subscribe(t=>{Oa=t});let Ba=void 0;nt.subscribe(t=>{Ba=t});let Xa=void 0;st.subscribe(t=>{Xa=t});let Ga=void 0;rt.subscribe(t=>{Ga=t});let qa=void 0;ot.subscribe(t=>{qa=t});let za=[void 0,void 0];it.subscribe(t=>{za=t});let Fa=void 0;ct.subscribe(t=>{Fa=t});let Ta=void 0;dt.subscribe(t=>{Ta=t});let ja=void 0;mt.subscribe(t=>{ja=t});const Da=(t,e,a,l,n)=>{const s=()=>{let r=+t.attr("data-origin-x"),o=+t.attr("data-origin-y"),i=+t.attr("data-tick"),d=i%e,c=Math.floor(i/e),g=r+d*a,u=o+c*a,p=(i+1)%(e*e);Na.selectAll(`rect.mask-${d}-${c}`).transition("window-sliding-mask").delay(l+100).duration(300).style("opacity",0),t.attr("data-tick",p).transition("window-sliding-input").delay(l).duration(200).attr("transform",`translate(${g}, ${u})`).on("end",()=>{0===p&&(_a||Ka(n)),Fa&&s()})};s()},Va=(t,e,a,l)=>{const n=()=>{let s=+t.attr("data-origin-x"),r=+t.attr("data-origin-y"),o=+e.attr("data-origin-x"),i=+t.attr("data-tick"),d=i%a,c=Math.floor(i/a),g=s+d*l,u=r+c*l,p=o+i%a*l,h=(i+1)%(a*a);Na.selectAll(`rect.mask-${d}-${c}`).transition("window-sliding-mask").delay(300).duration(300).style("opacity",0),t.attr("data-tick",h).transition("window-sliding-input").delay(200).duration(200).attr("transform",`translate(${g}, ${u})`),e.attr("data-tick",h).transition("window-sliding-result").delay(200).duration(200).attr("transform",`translate(${p}, ${u})`).on("end",()=>{Fa&&n()})};n()},Ka=t=>{null!==d3.event&&d3.event.stopPropagation();let e=ka/(3*Aa),a=3*Aa;if(_a){ct.set(!0),Na.selectAll(".kernel-clone").transition().duration(300).style("opacity",1),Na.selectAll("rect.mask-overlay").transition().duration(300).style("opacity",1);for(let l=0;l<Ba[t-1].length;l++)Va(d3.select(".kernel-input-"+l),d3.select(".kernel-result-"+l),e,a);Da(d3.select(".kernel-output"),e,a,200,t),Na.selectAll("path.flow-edge").attr("stroke-dasharray","4 2").attr("stroke-dashoffset",0).each((t,e,a)=>Wa(t,e,a,-1e3)),Na.select(".animation-control-button").attr("xlink:href","/cnn-explainer/assets/img/fast_forward.svg"),_a=!1}else{ct.set(!1),Na.selectAll("rect.mask-overlay").transition("skip").duration(600).style("opacity",0),Na.selectAll(".kernel-clone").attr("data-tick",0).transition("skip").duration(300).style("opacity",0).on("end",(t,e,a)=>{let l=d3.select(a[e]),n=+l.attr("data-origin-x"),s=+l.attr("data-origin-y");l.attr("transform",`translate(${n}, ${s})`)}),Na.selectAll("path.flow-edge").interrupt().attr("stroke-dasharray","0 0"),Na.select(".animation-control-button").attr("xlink:href","/cnn-explainer/assets/img/redo.svg"),_a=!0}},Wa=(t,e,a,l)=>{d3.select(a[e]).transition().duration(6e4).ease(d3.easeLinear).attr("stroke-dashoffset",l).on("end",(t,e,a)=>{Fa&&Wa(t,e,a,l-2e3)})},Ya=(t,e,a,l,n,s,r,o,i,d)=>{let c=Na.append("g").attr("class","intermediate-layer").style("opacity",0);_a=!1;let g=e+ka+n,u=g+ka+1.5*n,p=Ga[Xa][t],h=wa[s.type],y=[],m=[],f=s.inputLinks.map(t=>Be(t.weight)).reduce((t,e)=>[Math.min(t[0],e[0]),Math.max(t[1],e[1])]),x=Math.round(1e3*Math.max(...f.map(Math.abs)))/1e3*2,v=3*Aa,b=Ba[t][r].y,$=Na.select(`#layer-${t}-node-${r}`),w=$.append("g").attr("class","overlay-group").attr("transform",`translate(${a}, ${b})`),k=Math.floor(ka/v);for(let t=0;t<k;t++)for(let e=0;e<k;e++)w.append("rect").attr("class",`mask-overlay mask-${t}-${e}`).attr("width",v).attr("height",v).attr("x",t*v).attr("y",e*v).style("fill","var(--light-gray)").style("stroke","var(--light-gray)").style("opacity",1);$.select("rect.bounding").raise();let I=c.append("g").attr("class","kernel kernel-output kernel-clone").attr("transform",`translate(${a}, ${b})`);I.append("rect").attr("x",0).attr("y",0).attr("width",3*Aa).attr("height",3*Aa).attr("fill","none").attr("stroke",Ma),I.attr("data-tick",0).attr("data-origin-x",a).attr("data-origin-y",b);let L=ka/(3*Aa);Da(I,L,v,200,t),Ba[t-1].forEach((a,l)=>{let n=Oa[t-1][l].output,f=Oa[t][r].inputLinks[l].weight,b=$t(n,f);y.push(Be(b)),((t,e,a,l,n)=>{let s=l,r=document.createElement("canvas"),o=r.getContext("2d");r.width=s,r.height=s;let i=o.getImageData(0,0,s,s),d=i.data;for(let t=0;t<d.length;t+=4){let l=Math.floor(t/4),r=Math.floor(l/s),o=l%s,i=d3.rgb(a((n[r][o]+e/2)/e));d[t]=i.r,d[t+1]=i.g,d[t+2]=i.b,d[t+3]=255}let c=document.createElement("canvas");c.width=3*ka,c.height=3*ka;let g=c.getContext("2d");o.putImageData(i,0,0),g.drawImage(r,0,0,s,s,0,0,3*ka,3*ka);let u=c.toDataURL();t.attr("xlink:href",u),r.remove(),c.remove()})(((t,e,a,l,n,s,r,o,i,d,c)=>{let g=a.append("g").datum(Oa[t-1][s]).attr("class","intermediate-node").attr("cursor",c?"pointer":"default").attr("pointer-events",c?"all":"none").attr("node-index",s).on("mouseover",o).on("mouseleave",i).on("click",(a,l,n)=>d(a,l,n,e,t));g.append("image").attr("width",ka).attr("height",ka).attr("x",l).attr("y",n);let u=Math.floor(ka/r),p=g.append("g").attr("class","overlay-group").attr("transform",`translate(${l}, ${n})`);for(let t=0;t<u;t++)for(let e=0;e<u;e++)p.append("rect").attr("class",`mask-overlay mask-${t}-${e}`).attr("width",r).attr("height",r).attr("x",t*r).attr("y",e*r).style("fill","var(--light-gray)").style("stroke","var(--light-gray)").style("opacity",1);return g.append("rect").attr("class","bounding").attr("width",ka).attr("height",ka).attr("x",l).attr("y",n).style("fill","none").style("stroke",Ma).style("stroke-width",1),g})(t,r,c,g,a.y,l,v,o,i,d,!0).select("image"),p,h,s.output.length,b),m.push({source:Xe({x:e,y:a.y}),target:Ge({x:g,y:a.y}),name:`input-${l}-inter1-${l}`}),m.push({source:Xe({x:g,y:a.y}),target:Ge({x:u,y:Ba[t][r].y}),name:`inter1-${l}-inter2-1`});let $=e-3*Aa*2,w=c.append("g").attr("class","kernel kernel-"+l).attr("transform",`translate(${$}, ${a.y})`),k="Kernel weights: [",I=d3.format(".2f");for(let t=0;t<f.length;t++)for(let e=0;e<f[0].length;e++){w.append("rect").attr("class","kernel").attr("x",Aa*e).attr("y",Aa*t).attr("width",Aa).attr("height",Aa).attr("fill",qe(wa.weight,x,f[t][e],.2));let a="";a=0===e&&0==t?"":0===e?"; ":", ",k=k.concat(a,""+I(f[t][e]))}k=k.concat("]"),w.append("rect").attr("x",0).attr("y",0).attr("width",3*Aa).attr("height",3*Aa).attr("fill","none").attr("stroke",Ma),w.style("pointer-events","all").style("cursor","crosshair").on("mouseover",()=>{ht.set({show:!0,text:k})}).on("mouseleave",()=>{ht.set({show:!1,text:k})}).on("click",()=>{d3.event.stopPropagation()});let M=w.clone(!0).style("pointer-events","none").style("cursor","pointer").classed("kernel-clone",!0).classed("kernel-input-"+l,!0);M.style("opacity",.9).selectAll("rect.kernel").style("opacity",.7),M.attr("transform",`translate(${e}, ${a.y})`).attr("data-tick",0).attr("data-origin-x",e).attr("data-origin-y",a.y);let A=w.clone(!0).style("pointer-events","none").style("cursor","pointer").classed("kernel-clone",!0).classed("kernel-result-"+l,!0);A.style("opacity",.9).selectAll("rect.kernel").style("fill","none"),A.attr("transform",`translate(${g}, ${a.y})`).attr("data-origin-x",g).attr("data-origin-y",a.y),Va(M,A,L,v)});let M=y.reduce((t,e)=>[Math.min(t[0],e[0]),Math.max(t[1],e[1])]),A={min:M[0],max:M[1]},E=Ba[t][r].y+ka/2,R=c.append("g").attr("class","plus-symbol").attr("transform",`translate(${u+Ia}, ${E})`);R.append("rect").attr("x",-Ia).attr("y",-Ia).attr("width",2*Ia).attr("height",2*Ia).attr("rx",3).attr("ry",3).style("fill","none").style("stroke",Ma),R.append("rect").attr("x",-(Ia-3)).attr("y",-.5).attr("width",2*(Ia-3)).attr("height",1).style("fill",Ma),R.append("rect").attr("x",-.5).attr("y",-(Ia-3)).attr("width",1).attr("height",2*(Ia-3)).style("fill",Ma),0==r?(R.append("circle").attr("cx",0).attr("cy",ka/2+Aa).attr("r",4).style("stroke",Ma).style("cursor","crosshair").style("fill",qe(wa.weight,x,s.bias,.2)).on("mouseover",()=>{ht.set({show:!0,text:"Bias: "+Sa(s.bias)})}).on("mouseleave",()=>{ht.set({show:!1,text:"Bias: "+Sa(s.bias)})}),m.push({source:{x:u+Ia,y:Ba[t][r].y+ka},target:{x:u+Ia,y:Ba[t][r].y+ka/2+Ia},name:"bias-plus"})):(R.append("circle").attr("cx",0).attr("cy",-ka/2-Aa).attr("r",4).style("stroke",Ma).style("cursor","crosshair").style("fill",qe(wa.weight,x,s.bias,.2)).on("mouseover",()=>{ht.set({show:!0,text:"Bias: "+Sa(s.bias)})}).on("mouseleave",()=>{ht.set({show:!1,text:"Bias: "+Sa(s.bias)})}),m.push({source:{x:u+Ia,y:Ba[t][r].y},target:{x:u+Ia,y:Ba[t][r].y+ka/2-Ia},name:"bias-plus"})),m.push({source:Xe({x:u+2*Ia-ka,y:Ba[t][r].y}),target:Ge({x:a,y:Ba[t][r].y}),name:"symbol-output"}),m.push({source:Xe({x:a,y:Ba[t][r].y}),target:Ge({x:l,y:Ba[t][r].y}),name:"output-next"}),c.append("g").attr("class","layer-intermediate-label layer-label").attr("transform",()=>`translate(${g+ka/2}, ${(Ea.top+Ha)/2+5})`).classed("hidden",Ta).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("font-weight",800).style("opacity","0.8").text("intermediate"),c.append("g").attr("class","animation-control").attr("transform",()=>`translate(${g+ka/2}, ${(Ea.top+Ha)/2-4})`).on("click",()=>Ka(t)).append("image").attr("class","animation-control-button").attr("xlink:href","/cnn-explainer/assets/img/fast_forward.svg").attr("x",50).attr("y",0).attr("height",13).attr("width",13),c.append("g").attr("class","layer-intermediate-label layer-detailed-label").attr("transform",()=>`translate(${g+ka/2}, ${(Ea.top+Ha)/2-5})`).classed("hidden",!Ta).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity","0.7").style("font-weight",800).append("tspan").text("intermediate").append("tspan").style("font-size","8px").style("font-weight","normal").attr("x",0).attr("dy","1.5em").text(`(${Oa[t][0].output.length},\n      ${Oa[t][0].output[0].length},\n      ${Oa[t].length})`);let C=d3.linkHorizontal().x(t=>t.x).y(t=>t.y),S=c.append("g").attr("class","edge-group").lower();return S.selectAll("path").data(m).enter().append("path").classed("flow-edge",t=>"output-next"!==t.name).attr("id",t=>"edge-"+t.name).attr("d",t=>C({source:t.source,target:t.target})).style("fill","none").style("stroke-width",1).style("stroke",Ma),S.select("#edge-output-next").style("opacity",.1),S.selectAll("path.flow-edge").attr("stroke-dasharray","4 2").attr("stroke-dashoffset",0).each((t,e,a)=>Wa(t,e,a,-1e3)),{intermediateLayer:c,intermediateMinMax:A,kernelRange:x,kernelMinMax:{min:f[0],max:f[1]}}},Ua=t=>{let e,a,l,n,s,r,o,i,d,c,g,u,p=t.leftX,h=t.curLayerIndex,y=t.group,m=t.intermediateGap,f=t.isFirstConv,x=t.i,v=y.append("g").attr("class","kernel-annotation");v.append("text").text("Kernel").attr("class","annotation-text").attr("x",p-2.5*Aa*3).attr("y",Ba[h-1][0].y+3*Aa).style("dominant-baseline","baseline").style("text-anchor","end"),f?(e=p,a=Ba[h-1][0].y+ka+3*Aa,l=p-5,n=Ba[h-1][0].y+ka+3*Aa+5,s=20,r=p,o=Ba[h-1][1].y+ka+3*Aa,i=p-3*Aa,d=Ba[h-1][1].y+ka+15,g=p-13,u=Ba[h-1][1].y+15,c=35):(e=p-3*Aa*3,a=Ba[h-1][0].y+ka/3,l=p-2*Aa*3-5,n=Ba[h-1][0].y+ka-10,s=50,r=p-3*Aa*3,o=Ba[h-1][2].y-3,g=p-3*Aa-4,u=Ba[h-1][2].y+3*Aa+6,i=p-3*Aa-13,d=Ba[h-1][2].y+26,c=20);let b=v.append("text").attr("x",e).attr("y",a).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor",f?"start":"end");b.append("tspan").style("dominant-baseline","hanging").text("Slide kernel over input channel"),b.append("tspan").attr("x",e).attr("dy","1em").style("dominant-baseline","hanging").text("to get intermediate result"),b.append("tspan").attr("x",e).attr("dy","1.2em").style("dominant-baseline","hanging").style("font-weight",700).text("Click "),b.append("tspan").style("dominant-baseline","hanging").style("font-weight",400).text("to learn more"),$a({group:y,tx:p-7,ty:Ba[h-1][0].y+ka/2,sx:l,sy:n,hFlip:!f,dr:s,marker:"marker"});let $=v.append("text").attr("x",r).attr("y",o).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor",f?"start":"end");$.append("tspan").style("dominant-baseline","hanging").text("Each input chanel"),$.append("tspan").attr("x",e).attr("dy","1em").style("dominant-baseline","hanging").text("gets a different kernel"),$.append("tspan").attr("x",e).attr("dy","1.3em").style("font-weight",700).style("dominant-baseline","hanging").text("Hover over "),$.append("tspan").style("font-weight",400).style("dominant-baseline","hanging").text("to see value!"),$a({group:y,tx:g,ty:u,sx:i,sy:d,dr:c,hFlip:!f,marker:"marker"});let w=y.append("g").attr("class","plus-annotation"),k=p+2*ka+2.5*m,I=k,L=Ba[h][x].y+ka+3*Aa;0===x&&(I+=30),9===x&&(I=k+Ia-10,L-=2.5*ka);let M=w.append("text").attr("x",I).attr("y",L).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","start");M.append("tspan").style("dominant-baseline","hanging").text("Add up all intermediate"),M.append("tspan").attr("x",I).attr("dy","1em").style("dominant-baseline","hanging").text("results and then add bias"),$a(9===x?{group:y,sx:k+50,sy:Ba[h][x].y-(ka/2+2*Aa),tx:k+2*Ia+5,ty:Ba[h][x].y+ka/2-Ia,dr:50,hFlip:!1,marker:"marker-alt"}:{group:y,sx:k+35,sy:Ba[h][x].y+ka+2*Aa,tx:k+2*Ia+5,ty:Ba[h][x].y+ka/2+Ia,dr:30,hFlip:!0,marker:"marker-alt"});let A=Ba[h][x].y;0===x?A+=ka+3*Aa:A-=2*Aa+5,w.append("text").attr("class","annotation-text").attr("x",k+Ia).attr("y",A).style("text-anchor","middle").style("dominant-baseline",0===x?"hanging":"baseline").text("Bias")},Ja=(t,e,a,l,n,s,r,o)=>{let i=Na.select("g.underneath");for(let d=0;d<Oa[t-1].length;d++)i.append("rect").attr("class","underneath-gateway").attr("id","underneath-gateway-"+d).attr("x",a-n).attr("y",Ba[t-1][d].y-n).attr("width",2*ka+l+2*n).attr("height",ka+2*n).attr("rx",10).style("fill","rgba(160, 160, 160, 0.2)").style("opacity",0),Na.select(`g#layer-${t-1}-node-${d}`).style("pointer-events","all").style("cursor","pointer").on("mouseover",s).on("mouseleave",r).on("click",(a,l,n)=>o(a,l,n,e,t));i.lower()},Qa=(t,e,a,l,n)=>{Na.select(".intermediate-layer-overlay").empty()&&Na.append("g").attr("class","intermediate-layer-overlay"),Na.select(".intermediate-layer-overlay").append("rect").attr("class","overlay").style("fill",`url(#${t})`).style("stroke","none").attr("width",l).attr("height",n).attr("x",e).attr("y",a).style("opacity",0).transition("move").duration(800).ease(d3.easeCubicInOut).style("opacity",1)},Za=(t,e)=>{let a=Ga[Xa][t-1],l=Ga[Xa][t],n=Math.max(a,l);a>l?(Na.select(`g#layer-${t}-node-${e}`).select("image.node-image").each((t,e,a)=>ra(t,e,a,n)),za=[t,e],it.set(za)):a<l&&(Na.select("g#cnn-layer-group-"+(t-1)).selectAll("image.node-image").each((t,e,a)=>ra(t,e,a,n)),za=[t-1,void 0],it.set(za));let s=qa[t-1].min,r=qa[t-1].max,o=Oa[t][e];for(let t=0;t<o.output.length;t++)for(let e=0;e<o.output[0].length;e++)o.output[t][e]<s&&(s=o.output[t][e]),o.output[t][e]>r&&(r=o.output[t][e]);return{range:n,minMax:{min:s,max:r}}},tl=(t,e,a,l,n,s,r,o)=>{let i=Ba[t-1][0].x+2*ka+2*Pa*Ra+2*Ia,d=Pa*Ra*2/3,c=Ba[t-1][0].x;ja.conv_1_1=i+ka,mt.set(ja),Na.select("g.edge-group").style("visibility","hidden"),xa({layerIndex:t,targetX:i,disable:!0,delay:0,opacity:.15,specialIndex:a});let g=i+ka+Pa*Ra,u=(l-g-10*ka)/10;for(let e=t+1;e<La;e++){xa({layerIndex:e,targetX:g+(e-(t+1))*(ka+u),disable:!0,delay:0})}va("overlay-gradient",[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}]),Qa("overlay-gradient",g-Ca/2,0,l-g+Ca,n+Ea.top+Ea.bottom);let{intermediateLayer:p,intermediateMinMax:h,kernelRange:y,kernelMinMax:m}=Ya(t,c,i,g,d,e,a,s,r,o);Ja(t,a,c,d,8,s,r,o);let f=1/0,x=-1/0,v=Oa[t][a];for(let t=0;t<v.output.length;t++)for(let e=0;e<v.output[0].length;e++)v.output[t][e]<f&&(f=v.output[t][e]),v.output[t][e]>x&&(x=v.output[t][e]);let b={min:Math.min(f,h.min),max:Math.max(x,h.max)},$=Na.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);Ua({leftX:c,curLayerIndex:t,group:$,intermediateGap:d,isFirstConv:!0,i:a});let w=Ga.local[t];ba({legendHeight:5,curLayerIndex:t,range:1,group:p,width:2*ka+d,isInput:!0,x:c,y:Ea.top+10*Ha+Ha+10*ka-25}),ba({legendHeight:5,curLayerIndex:t,range:w,minMax:b,group:p,width:2*ka+d,x:Ba[t-1][2].x,y:Ea.top+10*Ha+Ha+10*ka}),ba({legendHeight:5,curLayerIndex:t,range:y,minMax:m,group:p,width:2*ka+d,x:i+ka-(2*ka+d),y:Ea.top+10*Ha+Ha+10*ka,gradientAppendingName:"kernelColorGradient",colorScale:wa.weight,gradientGap:.2}),Na.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},el=(t,e,a,l,n,s,r,o)=>{let i=Ba[t-1][0].x+2*ka+2*Pa*Ra+2*Ia,d=Pa*Ra*2/3;ja.conv_1_2=i+ka,mt.set(ja);let{range:c,minMax:g}=Za(t,a);Na.select("g.edge-group").style("visibility","hidden"),xa({layerIndex:t,targetX:i,disable:!0,delay:0,opacity:.15,specialIndex:a});let u=i+ka+Pa*Ra,p=(l-u-8*ka)/8;for(let e=t+1;e<La;e++){xa({layerIndex:e,targetX:u+(e-(t+1))*(ka+p),disable:!0,delay:0})}let h=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}];va("overlay-gradient-right",h),h=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85+(.95-.85)*((2*ka+Pa*Ra)/(8*ka+7*d))},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}],va("overlay-gradient-left",h),Qa("overlay-gradient-right",u-Ca/2,0,l-u+Ca,n+Ea.top+Ea.bottom),Qa("overlay-gradient-left",Ba[0][0].x-Ca/2,0,2*ka+Pa*Ra+Ca,n+Ea.top+Ea.bottom);let y=Ba[t-1][0].x,{intermediateLayer:m,intermediateMinMax:f,kernelRange:x,kernelMinMax:v}=Ya(t,y,i,u,d,e,a,s,r,o);Ja(t,a,y,d,5,s,r,o);let b={min:Math.min(g.min,f.min),max:Math.max(g.max,f.max)},$=Na.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);Ua({leftX:y,curLayerIndex:t,group:$,intermediateGap:d,i:a}),ba({legendHeight:5,curLayerIndex:t,range:c,minMax:b,group:m,width:2*ka+d,x:y,y:Ea.top+10*Ha+Ha+10*ka}),ba({legendHeight:5,curLayerIndex:t,range:x,minMax:v,group:m,width:2*ka+d,x:i+ka-(2*ka+d),y:Ea.top+10*Ha+Ha+10*ka,gradientAppendingName:"kernelColorGradient",colorScale:wa.weight,gradientGap:.2}),Na.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},al=(t,e,a,l,n,s,r,o)=>{let i=Ba[t][0].x,d=i-(2*ka+2*Pa*Ra+2*Ia),c=Pa*Ra*2/3;ja.conv_2_1=i+ka,mt.set(ja),Na.select("g.edge-group").style("visibility","hidden");let{range:g,minMax:u}=Za(t,a);xa({layerIndex:t-1,targetX:d,disable:!0,delay:0}),xa({layerIndex:t,targetX:i,disable:!0,delay:0,opacity:.15,specialIndex:a});let p=d-Pa,h=(p-Ba[0][0].x-5*ka)/5,y=Ba[t][0].x+ka+Pa;for(let e=0;e<t-1;e++){let t=Ba[0][0].x+e*(ka+h);xa({layerIndex:e,targetX:t,disable:!0,delay:0})}let m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];va("overlay-gradient-left",m),m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}],va("overlay-gradient-right",m),Qa("overlay-gradient-left",Ba[0][0].x-Ca/2,0,p-Ba[0][0].x+Ca,n+Ea.top+Ea.bottom),Qa("overlay-gradient-right",y-Ca/2,0,l-y+Ca,n+Ea.top+Ea.bottom);let{intermediateLayer:f,intermediateMinMax:x,kernelRange:v,kernelMinMax:b}=Ya(t,d,Ba[t][0].x,y,c,e,a,s,r,o);Ja(t,a,d,c,5,s,r,o);let $={min:Math.min(u.min,x.min),max:Math.max(u.max,x.max)},w=Na.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);Ua({leftX:d,curLayerIndex:t,group:w,intermediateGap:c,i:a}),ba({legendHeight:5,curLayerIndex:t,range:g,group:f,width:2*ka+c,minMax:$,x:d,y:Ea.top+10*Ha+Ha+10*ka}),ba({legendHeight:5,curLayerIndex:t,range:v,minMax:b,group:f,width:2*ka+c,x:i+ka-(2*ka+c),y:Ea.top+10*Ha+Ha+10*ka,gradientAppendingName:"kernelColorGradient",colorScale:wa.weight,gradientGap:.2}),Na.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},ll=(t,e,a,l,n,s,r,o)=>{let i=Ba[t][0].x,d=i-(2*ka+2*Pa*Ra+2*Ia),c=Pa*Ra*2/3;ja.conv_2_2=d,mt.set(ja),Na.select("g.edge-group").style("visibility","hidden");let{range:g,minMax:u}=Za(t,a);xa({layerIndex:t-1,targetX:d,disable:!0,delay:0}),xa({layerIndex:t,targetX:i,disable:!0,delay:0,opacity:.15,specialIndex:a});let p=d-Pa,h=(p-Ba[0][0].x-7*ka)/7,y=i+ka+Pa;for(let e=0;e<t-1;e++){let t=Ba[0][0].x+e*(ka+h);xa({layerIndex:e,targetX:t,disable:!0,delay:0})}let m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];va("overlay-gradient-left",m),m=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}],va("overlay-gradient-right",m),Qa("overlay-gradient-left",Ba[0][0].x-Ca/2,0,p-Ba[0][0].x+Ca,n+Ea.top+Ea.bottom),Qa("overlay-gradient-right",y-Ca/2,0,l-y+Ca,n+Ea.top+Ea.bottom);let{intermediateLayer:f,intermediateMinMax:x,kernelRange:v,kernelMinMax:b}=Ya(t,d,Ba[t][0].x,y,c,e,a,s,r,o);Ja(t,a,d,c,5,s,r,o);let $={min:Math.min(u.min,x.min),max:Math.max(u.max,x.max)},w=Na.append("g").attr("class","intermediate-layer-annotation").style("opacity",0);Ua({leftX:d,curLayerIndex:t,group:w,intermediateGap:c,i:a}),ba({legendHeight:5,curLayerIndex:t,range:g,group:f,minMax:$,width:2*ka+c,x:d,y:Ea.top+10*Ha+Ha+10*ka}),ba({legendHeight:5,curLayerIndex:t,range:v,minMax:b,group:f,width:2*ka+c,x:i+ka-(2*ka+c),y:Ea.top+10*Ha+Ha+10*ka,gradientAppendingName:"kernelColorGradient",colorScale:wa.weight,gradientGap:.2}),Na.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)},nl=Pe.layerColorScales,sl=Pe.nodeLength,rl=Pe.plusSymbolRadius,ol=Pe.intermediateColor,il=Pe.kernelRectLength,dl=Pe.svgPaddings,cl=Pe.gapRatio,gl=Pe.classLists,ul=d3.format(".4f");let pl=void 0;et.subscribe(t=>{pl=t});let hl=void 0;at.subscribe(t=>{hl=t});let yl=void 0;lt.subscribe(t=>{yl=t});let ml=void 0;tt.subscribe(t=>{ml=t});let fl=void 0;nt.subscribe(t=>{fl=t});let xl=void 0;st.subscribe(t=>{xl=t});let vl=void 0;rt.subscribe(t=>{vl=t});let bl=void 0;ot.subscribe(t=>{bl=t});let $l=void 0;gt.subscribe(t=>{$l=t});let wl=void 0;pt.subscribe(t=>{wl=t});let kl=void 0;ut.subscribe(t=>{kl=t});let Il=void 0;ht.subscribe(t=>{Il=t});let Ll=void 0;dt.subscribe(t=>{Ll=t});let Ml=10,Al=11,El=!1,Rl=[],Cl={};const Sl=(t,e,a,l,n,s)=>{let r=d3.select(a[e]);if(s){let t=+r.attr("data-preX"),e=+r.attr("data-preY");r.transition("softmax").duration(n).ease(d3.easeCubicInOut).attr("transform",`translate(${t}, ${e})`)}else{let t=r.attr("transform"),e=+t.replace(/.*\(([\d\.]+),.*/,"$1"),a=+t.replace(/.*,\s([\d\.]+)\)/,"$1");r.transition("softmax").duration(n).ease(d3.easeCubicInOut).attr("transform",`translate(${e-l}, ${a})`),r.attr("data-preX",e),r.attr("data-preY",a)}},_l=t=>{ht.set({show:!0,text:"Logit: "+ul(Rl[t])}),kl.highlightI=t,ut.set(kl);let e=pl.select(".logit-layer"),a=pl.select(".underneath"),l=pl.select(".intermediate-layer");e.select("#logit-circle-"+t).style("stroke-width",2),l.select("#plus-symbol-clone-"+t).style("opacity",1).select("circle").style("fill",t=>t.fill),a.select("#logit-lower-"+t).raise(),a.selectAll(".softmax-abstract-edge-"+t).style("stroke-width",.8).style("stroke","#E0E0E0"),a.selectAll(".softmax-edge-"+t).style("stroke-width",1).style("stroke","#E0E0E0"),a.selectAll(".logit-output-edge-"+t).style("stroke-width",3).style("stroke","#E0E0E0"),e.selectAll(".logit-output-edge-"+t).style("stroke-width",3).style("stroke","#E0E0E0")},Nl=t=>{ht.set({show:!1,text:"Logit: "+ul(Rl[t])}),kl.highlightI=-1,ut.set(kl);let e=pl.select(".logit-layer"),a=pl.select(".underneath"),l=pl.select(".intermediate-layer");e.select("#logit-circle-"+t).style("stroke-width",1),l.select("#plus-symbol-clone-"+t).style("opacity",.2),a.selectAll(".softmax-abstract-edge-"+t).style("stroke-width",.2).style("stroke","#EDEDED"),a.selectAll(".softmax-edge-"+t).style("stroke-width",.2).style("stroke","#F1F1F1"),a.selectAll(".logit-output-edge-"+t).style("stroke-width",1.2).style("stroke","#E5E5E5"),e.selectAll(".logit-output-edge-"+t).style("stroke-width",1.2).style("stroke","#E5E5E5")},Hl=t=>{_l(t.detail.curI)},Pl=t=>{Nl(t.detail.curI)},Ol=t=>{let e=t.curLayerIndex,a=t.moveX,l=t.symbolX,n=t.symbolY,s=t.outputX,r=t.outputY,o=t.softmaxLeftMid,i=t.selectedI,d=t.intermediateX1,c=t.intermediateX2,g=t.pixelWidth,u=t.pixelHeight,p=t.topY,h=t.bottomY,y=t.middleGap,m=t.middleRectHeight,f=t.softmaxX,x=t.softmaxTextY,v=t.softmaxWidth,b=t.symbolGroup,$=t.flattenRange,w=o-4*a/5;d3.event.stopPropagation(),$l?(pt.set(!1),pl.select(".logit-layer").remove(),pl.select(".logit-layer-lower").remove(),pl.selectAll(".plus-symbol-clone").remove(),pl.select(".underneath").selectAll(".logit-lower").style("opacity",0),ut.set({show:!1,logits:[]})):pt.set(!0),pl.select(".intermediate-layer-overlay").select("rect.overlay").transition("softmax").ease(d3.easeCubicInOut).duration(600).attr("transform",`translate(${$l?0:-a}, 0)`),pl.selectAll(".intermediate-legend-"+(e-1)).each((t,e,l)=>Sl(0,e,l,a,600,$l)),pl.select(".intermediate-layer").select(".layer-label").each((t,e,l)=>Sl(0,e,l,a,600,$l)),pl.select(".intermediate-layer").select(".layer-detailed-label").each((t,e,l)=>Sl(0,e,l,a,600,$l));for(let t=e-1;t>=0;t--){let e=+pl.select("g#cnn-layer-group-"+t).select("image").attr("x");xa({layerIndex:t,targetX:$l?e+a:e-a,disable:!0,delay:0,transitionName:"softmax",duration:600})}pl.select(".plus-annotation").transition("softmax").duration(600).style("opacity",$l?1:0).style("pointer-events",$l?"all":"none");let k=pl.select(".softmax-annotation").style("pointer-events",$l?"all":"none"),I=k.selectAll(".softmax-detail-annoataion").data([0]).enter().append("g").attr("class","softmax-detail-annoataion");$l&&k.selectAll(".softmax-detail-annoataion").remove(),k.select(".arrow-group").transition("softmax").duration(600).style("opacity",$l?1:0),k.select(".annotation-text").style("cursor","help").style("pointer-events","all").on("click",()=>{d3.event.stopPropagation(),document.querySelector("#article-softmax").scrollIntoView({behavior:"smooth"})}).transition("softmax").duration(600).style("opacity",$l?1:0).on("end",()=>{if(!$l){let t=f+v/2,a=x-10;0===i&&(a=x+70);let l=I.append("text").attr("x",t).attr("y",a).attr("class","annotation-text softmax-detail-text").style("dominant-baseline","baseline").style("text-anchor","middle").text("Normalize ");l.append("tspan").attr("dx",1).style("fill","#E56014").text("logits"),l.append("tspan").attr("dx",1).text(" into"),l.append("tspan").attr("x",t).attr("dy","1.1em").text("class probabilities"),$a(0===i?{group:I,sx:f+v/2-5,sy:x+44,tx:f+v/2,ty:a-12,dr:50,hFlip:!0,marker:"marker-alt"}:{group:I,sx:f+v/2-5,sy:x+4,tx:f+v/2,ty:n-rl-4,dr:50,hFlip:!0,marker:"marker-alt"}),t=w+45,a=(dl.top+hl)/2+5;let s=w+20,r=(dl.top+hl)/2+5;I.append("g").attr("class","layer-detailed-label").attr("transform",()=>`translate(${w}, ${(dl.top+hl)/2-5})`).classed("hidden",!Ll).append("text").style("opacity",.7).style("dominant-baseline","middle").style("font-size","12px").style("font-weight","800").append("tspan").attr("x",0).text("logit").append("tspan").attr("x",0).style("font-size","8px").style("font-weight","normal").attr("dy","1.5em").text("(10)"),I.append("text").attr("class","annotation-text").attr("x",t).attr("y",(dl.top+hl)/2+3).style("text-anchor","start").text("Before").append("tspan").attr("x",t).attr("dy","1em").text("normalization"),$a({group:I,tx:s,ty:r,sx:t-6,sy:a+2,dr:60,hFlip:!1,marker:"marker-alt"}),I.append("text").attr("class","annotation-text").attr("x",fl[Al][0].x-35).attr("y",(dl.top+hl)/2+3).style("text-anchor","end").text("After").append("tspan").attr("x",fl[Al][0].x-35).attr("dy","1em").text("normalization"),$a({group:I,tx:fl[Al][0].x-8,ty:r,sx:fl[Al][0].x-27,sy:a+2,dr:60,hFlip:!0,marker:"marker-alt"});for(let t=0;t<10;t++)I.append("text").attr("x",w).attr("y",fl[e-1][t].y+sl/2+8).attr("class","annotation-text softmax-detail-text").attr("id","logit-text-"+t).style("text-anchor","middle").style("dominant-baseline","hanging").style("opacity",0).text(""+gl[t]);let o=I.append("g").attr("class","softmax-detail-hover-annotation").style("opacity",0);t=w+50,a=fl[e-1][0].y+sl/2,i<3&&(a=fl[e-1][9].y+sl/2);let d=o.append("text").attr("x",t).attr("y",a).attr("class","annotation-text softmax-detail-text softmax-hover-text").style("text-anchor","start").style("dominant-baseline","baseline").append("tspan").style("font-weight",700).style("dominant-baseline","baseline").text("Hover over ").append("tspan").style("font-weight",400).style("dominant-baseline","baseline").text("to see");d.append("tspan").style("dominant-baseline","baseline").attr("x",t).attr("dy","1em").text("its "),d.append("tspan").style("dominant-baseline","baseline").attr("dx",1).style("fill","#E56014").text("logit"),d.append("tspan").style("dominant-baseline","baseline").attr("dx",1).text(" value"),$a({group:o,tx:w+15,ty:a,sx:t-8,sy:a+2,dr:60,hFlip:!1})}}),pl.select(".flatten-annotation").transition("softmax").duration(600).style("opacity",$l?1:0).style("pointer-events",$l?"all":"none");let L=pl.select(".flatten-layer-left");L.transition("softmax").duration(600).ease(d3.easeCubicInOut).attr("transform",`translate(${$l?0:-a}, 0)`).on("end",()=>{if(!$l){(t=>{let e=t.curLayerIndex,a=t.moveX,l=t.softmaxLeftMid,n=t.selectedI,s=t.intermediateX1,r=t.intermediateX2,o=t.pixelWidth,i=t.pixelHeight,d=t.topY,c=t.bottomY,g=t.softmaxX,u=t.middleGap,p=t.middleRectHeight,h=t.symbolGroup,y=t.symbolX,m=t.flattenRange,f=pl.select(".intermediate-layer").append("g").attr("class","logit-layer").raise(),x=pl.select(".intermediate-layer").select(".flatten-layer").select(".plus-symbol").clone(!0).attr("class","temp-clone-plus-symbol").attr("transform",`translate(${y-a},\n      ${fl[e][n].y+sl/2})`).style("pointer-events","none").remove(),v=f.append(()=>x.node());pl.select(".softmax-symbol").raise();let b=pl.select(".underneath").append("g").attr("class","logit-layer-lower").lower(),$=l-4*a/5;Rl=[];for(let t=0;t<ml[Al].length;t++)Rl.push(ml[Al][t].logit);let w=d3.scaleLinear().domain(d3.extent(Rl)).range([.2,1]);f.append("circle").attr("class","logit-circle").attr("id","logit-circle-"+n).attr("cx",$).attr("cy",fl[e-1][n].y+sl/2).attr("r",8).style("fill",nl.logit(w(Rl[n]))).style("cursor","crosshair").style("pointer-events","all").style("stroke",ol).on("mouseover",()=>_l(n)).on("mouseleave",()=>Nl(n)).on("click",()=>{d3.event.stopPropagation()});let k=pl.select(".intermediate-layer-annotation").select(".softmax-detail-annoataion");k.select("#logit-text-"+n).style("opacity",1),v.raise(),f.append("line").attr("class","logit-output-edge-"+n).attr("x1",r-a+2*rl).attr("x2",g).attr("y1",fl[e-1][n].y+sl/2).attr("y2",fl[e-1][n].y+sl/2).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2").lower();let I=[],L=ml.flatten.length/ml[1].length,M=[...Array(ml[Al].length).keys()].filter(t=>t!=n),A=0,E=d3.linkHorizontal().x(t=>t.x).y(t=>t.y);const R=()=>{if(!wl)return void pl.select(".underneath").selectAll(".logit-lower").remove();let t=M[A],l=pl.select(".underneath").select("#logit-lower-"+t);if(l.empty()){l=pl.select(".underneath").append("g").attr("class","logit-lower").attr("id","logit-lower-"+t).style("opacity",0);for(let l=0;l<L;l+=3){[0,9].forEach(n=>{let g=l+n*L;I.push({source:{x:s+o+3-a,y:0===n?d+l*i:c+l*i},target:{x:r-a,y:fl[e][t].y+sl/2},index:g,weight:ml.flatten[g].outputLinks[t].weight,color:"#F1F1F1",width:.5,opacity:1,class:"softmax-edge-"+t})})}for(let l=0;l<ml[Al].length-2;l++)I.push({source:{x:s+o+3-a,y:d+L*i+u*(l+1)+p*(l+.5)},target:{x:r-a,y:fl[e][t].y+sl/2},index:-1,color:"#EDEDED",width:.5,opacity:1,class:"softmax-abstract-edge-"+t});l.selectAll("path.softmax-edge-"+t).data(I).enter().append("path").attr("class",t=>t.class).attr("id",t=>"edge-"+t.name).attr("d",t=>E({source:t.source,target:t.target})).style("fill","none").style("stroke-width",t=>t.width).style("stroke",t=>void 0===t.color?ol:t.color).style("opacity",t=>t.opacity).style("pointer-events","none")}let x=f.append("g").attr("class","logit-layer-"+t).style("opacity",0),v=h.clone(!0).style("opacity",0);v.attr("class","plus-symbol-clone").attr("id","plus-symbol-clone-"+t).select("circle").datum({fill:qe(nl.weight,m,ml[Al][t].bias,.35)}).style("pointer-events","none").style("fill","#E5E5E5"),v.attr("transform",`translate(${y},\n      ${fl[e][t].y+sl/2})`);let C=E({source:{x:r-a+2*rl,y:fl[e][t].y+sl/2},target:{x:$+8,y:fl[e][t].y+sl/2}}),S=E({source:{x:$+8,y:fl[e][t].y+sl/2},target:{x:g,y:fl[e][n].y+sl/2}}),_=b.append("path").attr("class","logit-output-edge-"+t).attr("d",C).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2"),N=b.append("path").attr("class","logit-output-edge-"+t).attr("d",S).style("fill","none").style("stroke","#EAEAEA").style("stroke-width","1.2"),H=_.node().getTotalLength(),P=N.node().getTotalLength(),O=H+P,B=El?500:800,X=El?400:600;_.attr("stroke-dasharray",H+" "+H).attr("stroke-dashoffset",H),N.attr("stroke-dasharray",P+" "+P).attr("stroke-dashoffset",P),_.transition("softmax-output-edge").duration(H/O*B).attr("stroke-dashoffset",0),N.transition("softmax-output-edge").delay(H/O*B).duration(P/O*B).attr("stroke-dashoffset",0),x.append("circle").attr("class","logit-circle").attr("id","logit-circle-"+t).attr("cx",$).attr("cy",fl[e-1][t].y+sl/2).attr("r",7).style("fill",nl.logit(w(Rl[t]))).style("stroke",ol).style("cursor","crosshair").on("mouseover",()=>_l(t)).on("mouseleave",()=>Nl(t)).on("click",()=>{d3.event.stopPropagation()}),kl.startAnimation={i:t,duration:X,hasInitialized:!1},ut.set(kl),x.transition("softmax-edge").duration(X).style("opacity",1),(n<3&&9==t||n>=3&&0==t)&&k.select(".softmax-detail-hover-annotation").transition("softmax-edge").duration(X).style("opacity",1),k.select("#logit-text-"+t).transition("softmax-edge").duration(X).style("opacity",1),l.transition("softmax-edge").duration(X).style("opacity",1).on("end",()=>{A++,A<M.length?(I=[],R()):(El=!0,kl.hasInitialized=!0,ut.set(kl))}),v.transition("softmax-edge").duration(X).style("opacity",.2)};let C=pl.select(".intermediate-layer").select(".layer-label").node(),S=((t,e)=>{if(void 0!==t){let a=e;for(;null==a.getScreenCTM&&null!=a.parentNode;)a=a.parentNode;let l=t.node().ownerSVGElement.createSVGPoint(),n=a.getScreenCTM(),s=a.getBBox().height;l.x+=0,l.y-=s/2;let r=l.matrixTransform(n);return{top:r.y,left:r.x}}})(pl,C),_=100+ +d3.select("#cnn-svg").style("height").replace("px","")/2-96;const N=document.getElementById("detailview");N.style.top=_+"px",N.style.left=S.left-490-50+"px",N.style.position="absolute",ut.set({show:!0,logits:Rl,logitColors:Rl.map(t=>nl.logit(w(t))),selectedI:n,highlightI:-1,outputName:gl[n],outputValue:ml[Al][n].output,startAnimation:{i:-1,duration:0,hasInitialized:El}}),R(),ba({legendHeight:5,curLayerIndex:e,range:d3.extent(Rl)[1]-d3.extent(Rl)[0],minMax:{min:d3.extent(Rl)[0],max:d3.extent(Rl)[1]},group:f,width:g-(r+2*rl-a+5),gradientAppendingName:"flatten-logit-gradient",gradientGap:.1,colorScale:nl.logit,x:r+2*rl-a+5,y:dl.top+10*hl+hl+10*sl}),f.append("g").attr("class","layer-label").classed("hidden",Ll).attr("transform",()=>`translate(${$}, ${(dl.top+hl)/2+5})`).append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity",.8).style("font-weight",800).text("logit")})({curLayerIndex:e,moveX:a,softmaxLeftMid:o,selectedI:i,intermediateX1:d,intermediateX2:c,pixelWidth:g,pixelHeight:u,topY:p,bottomY:h,middleGap:y,middleRectHeight:m,softmaxX:f,symbolGroup:b,symbolX:l,flattenRange:$})}if($l)L.select(".symbol-output-line").remove();else{L.select(".edge-group").append("line").attr("class","symbol-output-line").attr("x1",l).attr("y1",n).attr("x2",s+a).attr("y2",r).style("stroke-width",1.2).style("stroke","#E5E5E5").style("opacity",0).transition("softmax").delay(200).duration(400).style("opacity",1)}$l=!$l,gt.set($l)})},Bl=(t,e,a,l,n)=>{pl.selectAll(".output-legend").classed("hidden",!1);let s=sl/2,r=2*sl+5.5*yl*cl+s,o=fl[t][0].x-r,i=yl*cl*4/2;let d=d3.linkHorizontal().x(t=>t.x).y(t=>t.y);pl.select("g.edge-group").style("visibility","hidden"),xa({layerIndex:t-1,targetX:o,disable:!0,delay:0}),xa({layerIndex:t,targetX:fl[t][0].x,disable:!0,delay:0,opacity:.15,specialIndex:a});let c=(o-yl-fl[0][0].x-10*sl)/10;if(c>20)for(let e=0;e<t-1;e++){let t=fl[0][0].x+e*(sl+c);xa({layerIndex:e,targetX:t,disable:!0,delay:0})}else{c=20;let e=o-2*c-sl;for(let a=t-2;a>=0;a--)xa({layerIndex:a,targetX:e,disable:!0,delay:0}),e=e-c-sl}va("overlay-gradient-left",[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.95},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}]);let g=pl.append("g").attr("class","intermediate-layer-overlay");g.append("rect").attr("class","overlay").style("fill","url(#overlay-gradient-left)").style("stroke","none").attr("width",o+dl.left-2*c+3).attr("height",n+dl.top+dl.bottom).attr("x",-dl.left).attr("y",0).style("opacity",0),g.selectAll("rect.overlay").transition("move").duration(800).ease(d3.easeCubicInOut).style("opacity",1);let u=pl.append("g").attr("class","intermediate-layer").style("opacity",0),p=o+sl+i,h=p+i+s,y=vl[xl][t-1],m=nl.conv,f=ml.flatten.length/ml[1].length,x=[],v=u.append("g").attr("class","flatten-layer").append("g").attr("class","flatten-layer-left"),b=fl[t-1][0].y,$=fl[t-1][9].y+sl-1.1*f,w=ml[t-1][0].output.length,k=sl/(2*w),I=sl/w,L=d3.extent(ml.flatten.slice(f).map(t=>t.outputLinks[a].weight).concat(ml.flatten.slice(9*f,10*f).map(t=>t.outputLinks[a].weight))),M=Math.round(1e3*Math.max(...L.map(Math.abs)))/1e3*2,A=t=>{let e=t.index;Il=void 0===t.weight?{show:!0,text:"Pixel value: "+ul(Cl[e])}:{show:!0,text:"Weight: "+ul(t.weight)},ht.set(Il),v.select("#edge-flatten-"+e).raise().style("stroke",ol).style("stroke-width",1),v.select(`#edge-flatten-${e}-output`).raise().style("stroke-width",1).style("stroke",t=>qe(nl.weight,M,t.weight,.1)),v.select("#bounding-"+e).raise().style("opacity",1)},E=t=>{let e=t.index;Il=void 0===t.weight?{show:!1,text:"Pixel value: "+ul(Cl[e])}:{show:!1,text:"Weight: "+ul(t.weight)},ht.set(Il),v.select("#edge-flatten-"+e).style("stroke-width",.6).style("stroke","#E5E5E5"),v.select(`#edge-flatten-${e}-output`).style("stroke-width",.6).style("stroke",t=>qe(nl.weight,M,t.weight,.35)),v.select("#bounding-"+e).raise().style("opacity",0)};Cl={};for(let e=0;e<f;e++){[0,9].forEach(l=>{let n=e+l*f;Cl[n]=ml.flatten[n].output,v.append("rect").attr("x",p).attr("y",0===l?b+1.1*e:$+1.1*e).attr("width",s).attr("height",1.1).style("cursor","crosshair").style("fill",m((ml.flatten[n].output+y/2)/y)).on("mouseover",()=>A({index:n})).on("mouseleave",()=>E({index:n})).on("click",()=>{d3.event.stopPropagation()}),x.push({source:{x:p+s+3,y:0===l?b+1.1*e:$+1.1*e},target:{x:h,y:fl[t][a].y+sl/2},index:n,weight:ml.flatten[n].outputLinks[a].weight,name:`flatten-${n}-output`,color:qe(nl.weight,M,ml.flatten[n].outputLinks[a].weight,.35),width:.6,opacity:1,class:"flatten-output"});let r=Math.floor(e/w);x.push({target:{x:p-3,y:0===l?b+1.1*e:$+1.1*e},source:{x:o+sl+3,y:fl[t-1][l].y+(2*r+1)*k},index:n,name:"flatten-"+n,color:"#E5E5E5",width:.6,opacity:1,class:"flatten"});let i=ml.flatten[n].inputLinks[0].weight;v.append("rect").attr("id","bounding-"+n).attr("class","flatten-bounding").attr("x",o+i[1]*I).attr("y",fl[t-1][l].y+i[0]*I).attr("width",I).attr("height",I).style("fill","none").style("stroke",ol).style("stroke-length","0.5").style("pointer-events","all").style("cursor","crosshair").style("opacity",0).on("mouseover",()=>A({index:n})).on("mouseleave",()=>E({index:n})).on("click",()=>{d3.event.stopPropagation()})})}let R=[];for(let e=1;e<ml[t-1].length-1;e++)R.push({index:e});let C=(10*sl+9*hl-1.1*f*2-45)/8;R.forEach((e,l)=>{v.append("rect").attr("x",p+s/4).attr("y",b+1.1*f+5*(l+1)+C*l).attr("width",s/2).attr("height",C).style("fill","#E5E5E5"),v.append("polyline").attr("points",`${o+sl+3}\n        ${fl[t-1][e.index].y},\n        ${o+sl+10}\n        ${fl[t-1][e.index].y+sl/2},\n        ${o+sl+3}\n        ${fl[t-1][e.index].y+sl}`).style("fill","#E5E5E5").style("opacity",1),x.push({source:{x:o+sl+10,y:fl[t-1][e.index].y+sl/2},target:{x:p-3,y:b+1.1*f+5*(l+1)+C*(l+.5)},index:-1,width:1,opacity:1,name:"flatten-abstract-"+e.index,color:"#E5E5E5",class:"flatten-abstract"}),x.push({source:{x:p+s+3,y:b+1.1*f+5*(l+1)+C*(l+.5)},target:{x:h,y:fl[t][a].y+sl/2},index:-1,name:`flatten-abstract-${e.index}-output`,color:"#E5E5E5",weight:e.weight,width:1,opacity:1,class:"flatten-abstract-output"})});let S=h+rl,_=fl[t][a].y+sl/2,N=v.append("g").attr("class","plus-symbol").attr("transform",`translate(${S}, ${_})`);N.append("rect").attr("x",-rl).attr("y",-rl).attr("width",2*rl).attr("height",2*rl).attr("rx",3).attr("ry",3).style("fill","none").style("stroke",ol),N.append("rect").attr("x",-(rl-3)).attr("y",-.5).attr("width",2*(rl-3)).attr("height",1).style("fill",ol),N.append("rect").attr("x",-.5).attr("y",-(rl-3)).attr("width",1).attr("height",2*(rl-3)).style("fill",ol),N.append("circle").attr("cx",0).attr("cy",-sl/2-.5*il).attr("r",1.5*il).style("stroke",ol).style("cursor","crosshair").style("fill",qe(nl.weight,M,e.bias,.35)).on("mouseover",()=>{ht.set({show:!0,text:"Bias: "+ul(e.bias)})}).on("mouseleave",()=>{ht.set({show:!1,text:"Bias: "+ul(e.bias)})}).on("click",()=>{d3.event.stopPropagation()}),N.append("path").attr("d",d({source:{x:0,y:0},target:{x:0,y:-sl/2-.5*il}})).attr("id","bias-plus").attr("stroke-width",1.2).attr("stroke","#E5E5E5").lower(),x.push({source:Xe({x:h+2*rl-sl,y:fl[t][a].y}),target:Ge({x:fl[t][a].x-3,y:fl[t][a].y}),name:"symbol-output",width:1.2,color:"#E5E5E5"});let H=(r-2*sl-2*i-55)/2,P=h+2*rl,O=H+P,B=H/2+P,X=fl[t][a].y-2*il-6,G={curLayerIndex:t,moveX:2*(h-(p+s+3))/3,symbolX:S,symbolY:_,outputX:fl[t][a].x,outputY:_,softmaxLeftMid:B,selectedI:a,intermediateX1:p,intermediateX2:h,pixelWidth:s,pixelHeight:1.1,topY:b,bottomY:$,middleGap:5,middleRectHeight:C,softmaxX:O,softmaxWidth:55,softmaxTextY:X,symbolGroup:N,flattenRange:M},q=u.append("g").attr("class","softmax-symbol").attr("transform",`translate(${O}, ${_})`).style("pointer-event","all").style("cursor","pointer").on("click",()=>Ol(G));q.append("rect").attr("x",0).attr("y",-rl).attr("width",55).attr("height",2*rl).attr("stroke",ol).attr("rx",2).attr("ry",2).attr("fill","#FAFAFA"),q.append("text").attr("x",5).attr("y",1).style("dominant-baseline","middle").style("font-size","12px").style("opacity",.5).text("softmax"),u.append("g").attr("class","layer-label").classed("hidden",Ll).attr("transform",()=>`translate(${o+sl+(4*yl*cl+s)/2}, ${(dl.top+hl)/2+5})`).style("cursor","help").on("click",()=>{d3.event.stopPropagation(),document.querySelector("#article-flatten").scrollIntoView({behavior:"smooth"})}).append("text").style("dominant-baseline","middle").style("opacity",.8).style("font-weight",800).text("flatten");let z=Number(d3.select("#cnn-svg").style("height").replace("px",""))+150,F=new SmoothScroll('a[href*="#"]',{offset:-z}),T=u.append("g").attr("transform",()=>`translate(${o+sl+(4*yl*cl+s)/2}, ${(dl.top+hl)/2-5})`).attr("class","layer-detailed-label").classed("hidden",!Ll).style("cursor","help").on("click",()=>{d3.event.stopPropagation();let t=document.querySelector("#article-flatten");F.animateScroll(t)});T.append("title").text("Move to article section");let j=T.append("text").style("text-anchor","middle").style("dominant-baseline","middle").style("opacity","0.7").style("font-weight",800).append("tspan").text("flatten"),D=ml[Ml].length*ml[Ml][0].output.length*ml[Ml][0].output[0].length;j.append("tspan").attr("x",0).attr("dy","1.5em").style("font-size","8px").style("font-weight","normal").text(`(${D})`);let V=v.append("g").attr("class","edge-group").lower();V.selectAll("path").data(x).enter().append("path").attr("class",t=>t.class).attr("id",t=>"edge-"+t.name).attr("d",t=>d({source:t.source,target:t.target})).style("fill","none").style("stroke-width",t=>t.width).style("stroke",t=>void 0===t.color?ol:t.color).style("opacity",t=>t.opacity),V.selectAll("path.flatten-abstract-output").lower(),V.selectAll("path.flatten,path.flatten-output").style("cursor","crosshair").style("pointer-events","all").on("mouseover",A).on("mouseleave",E).on("click",()=>{d3.event.stopPropagation()}),ba({legendHeight:5,curLayerIndex:t,range:y,minMax:bl[10],group:u,width:i+sl-3,x:o,y:dl.top+10*hl+hl+10*sl}),ba({legendHeight:5,curLayerIndex:t,range:M,minMax:{min:L[0],max:L[1]},group:u,width:i-3-5,gradientAppendingName:"flatten-weight-gradient",gradientGap:.1,colorScale:nl.weight,x:o+i+sl+s+3,y:dl.top+10*hl+hl+10*sl});let K=pl.append("g").attr("class","intermediate-layer-annotation").style("opacity",0),W=K.append("g").attr("class","plus-annotation"),Y=h,U=fl[t][a].y+sl+3*il,J=fl[t][a].y+sl+2*il,Q=fl[t][a].y+sl/2+rl;9==a&&(U-=110,J-=70,Q-=18);let Z=W.append("text").attr("x",Y).attr("y",U).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");Z.append("tspan").style("dominant-baseline","hanging").text("Add up all products"),Z.append("tspan").attr("x",Y).attr("dy","1em").style("dominant-baseline","hanging").text("("),Z.append("tspan").style("fill","#66a3c8").style("dominant-baseline","hanging").text("element"),Z.append("tspan").style("dominant-baseline","hanging").text(" × "),Z.append("tspan").style("dominant-baseline","hanging").style("fill","#b58946").text("weight"),Z.append("tspan").style("dominant-baseline","hanging").text(")"),Z.append("tspan").attr("x",Y).attr("dy","1em").style("dominant-baseline","hanging").text("and then "),Z.append("tspan").style("dominant-baseline","hanging").style("fill","#479d94").text("bias"),$a({group:W,sx:h-2*rl-3,sy:J,tx:h-5,ty:Q,dr:30,hFlip:9===a,marker:"marker-alt"});let tt=fl[t][a].y;tt-=2*il+4,v.append("text").attr("class","annotation-text").attr("x",h+rl).attr("y",tt).style("text-anchor","middle").style("dominant-baseline","baseline").text("Bias");let et=K.append("g").attr("class","softmax-annotation");et.append("text").attr("x",O+27.5).attr("y",X).attr("class","annotation-text").style("dominant-baseline","baseline").style("text-anchor","middle").style("font-weight",700).text("Click ").append("tspan").attr("dx",1).style("font-weight",400).text("to learn more"),$a({group:et,sx:O+27.5-5,sy:X+4,tx:O+27.5,ty:_-rl-4,dr:50,hFlip:!0});let at=K.append("g").attr("class","flatten-annotation");Y=o-80,U=fl[t-1][0].y;let lt=at.append("text").attr("x",Y).attr("y",U).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");lt.append("tspan").style("dominant-baseline","hanging").style("font-weight",700).text("Hover over ").append("tspan").attr("dx",1).style("font-weight",400).style("dominant-baseline","hanging").text("matrix to"),lt.append("tspan").style("dominant-baseline","hanging").attr("x",Y).attr("dy","1em").text("see how it is flattened"),lt.append("tspan").style("dominant-baseline","hanging").attr("x",Y).attr("dy","1em").text("into a 1D array!"),$a({group:at,sx:Y+45,sy:U+.4*sl+12,tx:o-10,ty:U+sl/2,dr:80,hFlip:!0}),U=fl[t-1][1].y;let nt=at.append("text").attr("x",Y).attr("y",U).attr("class","annotation-text").style("dominant-baseline","hanging").style("text-anchor","middle");nt.append("tspan").style("dominant-baseline","hanging").text("Same flattening"),nt.append("tspan").style("dominant-baseline","hanging").attr("x",Y).attr("dy","1em").text("operation for"),nt.append("tspan").style("dominant-baseline","hanging").attr("x",Y).attr("dy","1em").text("each neuron"),$a({group:at,sx:Y+39,sy:U+25,tx:o-10,ty:U+sl/2-2,dr:80,hFlip:!0,marker:"marker-alt"}),K.append("g").attr("class","output-annotation").append("text").attr("x",fl[Al][a].x).attr("y",fl[Al][a].y+10).attr("class","annotation-text").text(`(${d3.format(".4f")(ml[Al][a].output)})`),pl.selectAll("g.intermediate-layer, g.intermediate-layer-annotation").transition().delay(500).duration(500).ease(d3.easeCubicInOut).style("opacity",1)};function Xl(t,e,a){const l=t.slice();return l[82]=e[a],l[84]=a,l}function Gl(t){let e,a,l,s,r,o,p,y,x;return{c(){e=u("div"),a=u("img"),o=h(),i(a.src,l="/cnn-explainer/assets/img/"+t[82].file)||f(a,"src",l),f(a,"alt","image option"),f(a,"title",s=t[82].class),f(a,"data-imagename",r=t[82].file),f(a,"class","svelte-ydn4ia"),f(e,"class","image-container svelte-ydn4ia"),f(e,"data-imagename",p=t[82].file),k(e,"inactive",t[7]!==t[82].file),k(e,"disabled",t[6])},m(l,s){c(l,e,s),d(e,a),d(e,o),y||(x=m(e,"click",(function(){n(t[6]?Dl:t[16])&&(t[6]?Dl:t[16]).apply(this,arguments)})),y=!0)},p(a,l){t=a,16512&l[0]&&k(e,"inactive",t[7]!==t[82].file),64&l[0]&&k(e,"disabled",t[6])},d(t){t&&g(e),y=!1,x()}}}function ql(t){let e,a;return e=new ye({props:{logits:t[3].logits,logitColors:t[3].logitColors,selectedI:t[3].selectedI,highlightI:t[3].highlightI,outputName:t[3].outputName,outputValue:t[3].outputValue,startAnimation:t[3].startAnimation}}),e.$on("xClicked",t[23]),e.$on("mouseOver",Hl),e.$on("mouseLeave",Pl),{c(){V(e.$$.fragment)},m(t,l){K(e,t,l),a=!0},p(t,a){const l={};8&a[0]&&(l.logits=t[3].logits),8&a[0]&&(l.logitColors=t[3].logitColors),8&a[0]&&(l.selectedI=t[3].selectedI),8&a[0]&&(l.highlightI=t[3].highlightI),8&a[0]&&(l.outputName=t[3].outputName),8&a[0]&&(l.outputValue=t[3].outputValue),8&a[0]&&(l.startAnimation=t[3].startAnimation),e.$set(l)},i(t){a||(j(e.$$.fragment,t),a=!0)},o(t){D(e.$$.fragment,t),a=!1},d(t){W(e,t)}}}function zl(t){let e,a;return e=new ge({props:{input:t[8][0].input,kernelLength:2,dataRange:t[8].colorRange,isExited:t[10]}}),e.$on("message",t[21]),{c(){V(e.$$.fragment)},m(t,l){K(e,t,l),a=!0},p(t,a){const l={};256&a[0]&&(l.input=t[8][0].input),256&a[0]&&(l.dataRange=t[8].colorRange),1024&a[0]&&(l.isExited=t[10]),e.$set(l)},i(t){a||(j(e.$$.fragment,t),a=!0)},o(t){D(e.$$.fragment,t),a=!1},d(t){W(e,t)}}}function Fl(t){let e,a;return e=new ee({props:{input:t[8][0].input,output:t[8][0].output,dataRange:t[8].colorRange,isExited:t[10]}}),e.$on("message",t[22]),{c(){V(e.$$.fragment)},m(t,l){K(e,t,l),a=!0},p(t,a){const l={};256&a[0]&&(l.input=t[8][0].input),256&a[0]&&(l.output=t[8][0].output),256&a[0]&&(l.dataRange=t[8].colorRange),1024&a[0]&&(l.isExited=t[10]),e.$set(l)},i(t){a||(j(e.$$.fragment,t),a=!0)},o(t){D(e.$$.fragment,t),a=!1},d(t){W(e,t)}}}function Tl(t){let e,a;return e=new Kt({props:{input:t[8][t[9]].input,kernel:t[8][t[9]].kernel,dataRange:t[8].colorRange,colorScale:t[8].inputIsInputLayer?t[13].input[0]:t[13].conv,isInputInputLayer:t[8].inputIsInputLayer,isExited:t[11]}}),e.$on("message",t[20]),{c(){V(e.$$.fragment)},m(t,l){K(e,t,l),a=!0},p(t,a){const l={};768&a[0]&&(l.input=t[8][t[9]].input),768&a[0]&&(l.kernel=t[8][t[9]].kernel),256&a[0]&&(l.dataRange=t[8].colorRange),256&a[0]&&(l.colorScale=t[8].inputIsInputLayer?t[13].input[0]:t[13].conv),256&a[0]&&(l.isInputInputLayer=t[8].inputIsInputLayer),2048&a[0]&&(l.isExited=t[11]),e.$set(l)},i(t){a||(j(e.$$.fragment,t),a=!0)},o(t){D(e.$$.fragment,t),a=!1},d(t){W(e,t)}}}function jl(t){let e,a,s,r,o,y,x,b,I,L,M,A,E,R,C,S,_,N,H,O,B,X,G,q,z,Y,U,J,Q,Z,tt,et,at,lt,nt,st,rt,ot,it,dt,ct,gt,ut,pt,ht=t[4].text+"",yt=t[14],mt=[];for(let e=0;e<yt.length;e+=1)mt[e]=Gl(Xl(t,yt,e));nt=new ke({});const ft=[Tl,Fl,zl,ql],xt=[];function vt(t,e){return t[5].data&&"conv"===t[5].data.type&&-1!=t[9]?0:t[5].data&&"relu"===t[5].data.type?1:t[5].data&&"pool"===t[5].data.type?2:t[3].show?3:-1}return~(ot=vt(t))&&(it=xt[ot]=ft[ot](t)),ct=new xe({}),ct.$on("xClicked",t[18]),ct.$on("urlTyped",t[19]),{c(){e=u("div"),a=u("div"),s=u("div");for(let t=0;t<mt.length;t+=1)mt[t].c();r=h(),o=u("div"),y=u("img"),b=h(),I=u("span"),I.innerHTML='<i class="fas fa-circle fa-stack-2x"></i> \n            <i class="fas fa-pen fa-stack-1x fa-inverse"></i>',M=h(),A=u("button"),E=u("span"),E.innerHTML='<i class="fas fa-crosshairs "></i>',R=h(),C=u("span"),S=p(ht),_=h(),N=u("div"),H=u("button"),O=u("span"),O.innerHTML='<i class="fas fa-eye"></i>',B=h(),X=u("span"),X.textContent="Details",G=h(),q=u("div"),z=u("span"),z.innerHTML='<i class="fas fa-palette"></i>',Y=h(),U=u("div"),J=u("select"),Q=u("option"),Q.textContent="Einheit",Z=u("option"),Z.textContent="Modul",tt=u("option"),tt.textContent="Global",et=h(),at=u("div"),at.innerHTML='<svg id="cnn-svg" class="svelte-ydn4ia"></svg>',lt=h(),V(nt.$$.fragment),st=h(),rt=u("div"),it&&it.c(),dt=h(),V(ct.$$.fragment),f(y,"class","custom-image svelte-ydn4ia"),i(y.src,x="/cnn-explainer/assets/img/plus.svg")||f(y,"src","/cnn-explainer/assets/img/plus.svg"),f(y,"alt","plus button"),f(y,"title","Add new input image"),f(y,"data-imagename","custom"),f(I,"class","fa-stack edit-icon svelte-ydn4ia"),k(I,"hidden",null===t[12]),f(o,"class","image-container svelte-ydn4ia"),f(o,"data-imagename",L="custom"),k(o,"inactive","custom"!==t[7]),k(o,"disabled",t[6]),f(E,"class","icon"),$(E,"margin-right","5px"),f(C,"id","hover-label-text"),f(A,"class","button is-very-small is-link is-light svelte-ydn4ia"),f(A,"id","hover-label"),$(A,"opacity",t[4].show?1:0),f(s,"class","left-control svelte-ydn4ia"),f(O,"class","icon"),f(X,"id","hover-label-text"),f(H,"class","button is-very-small svelte-ydn4ia"),f(H,"id","detailed-button"),H.disabled=t[6],k(H,"is-activated",t[2]),f(z,"class","icon is-left"),Q.__value="local",Q.value=Q.__value,Z.__value="module",Z.value=Z.__value,tt.__value="global",tt.value=tt.__value,f(J,"id","level-select"),J.disabled=t[6],f(J,"class","svelte-ydn4ia"),void 0===t[0]&&P(()=>t[24].call(J)),f(U,"class","select svelte-ydn4ia"),f(q,"class","control is-very-small has-icons-left svelte-ydn4ia"),f(q,"title","Change color scale range"),f(N,"class","right-control svelte-ydn4ia"),f(a,"class","control-container svelte-ydn4ia"),f(at,"class","cnn svelte-ydn4ia"),f(e,"class","overview svelte-ydn4ia"),f(rt,"id","detailview")},m(l,i){c(l,e,i),d(e,a),d(a,s);for(let t=0;t<mt.length;t+=1)mt[t]&&mt[t].m(s,null);d(s,r),d(s,o),d(o,y),d(o,b),d(o,I),d(s,M),d(s,A),d(A,E),d(A,R),d(A,C),d(C,S),d(a,_),d(a,N),d(N,H),d(H,O),d(H,B),d(H,X),d(N,G),d(N,q),d(q,z),d(q,Y),d(q,U),d(U,J),d(J,Q),d(J,Z),d(J,tt),w(J,t[0],!0),d(e,et),d(e,at),t[25](e),c(l,lt,i),K(nt,l,i),c(l,st,i),c(l,rt,i),~ot&&xt[ot].m(rt,null),c(l,dt,i),K(ct,l,i),gt=!0,ut||(pt=[m(o,"click",(function(){n(t[6]?Vl:t[17])&&(t[6]?Vl:t[17]).apply(this,arguments)})),m(H,"click",t[15]),m(J,"change",t[24])],ut=!0)},p(e,a){if(t=e,82112&a[0]){let e;for(yt=t[14],e=0;e<yt.length;e+=1){const l=Xl(t,yt,e);mt[e]?mt[e].p(l,a):(mt[e]=Gl(l),mt[e].c(),mt[e].m(s,r))}for(;e<mt.length;e+=1)mt[e].d(1);mt.length=yt.length}(!gt||4096&a[0])&&k(I,"hidden",null===t[12]),(!gt||128&a[0])&&k(o,"inactive","custom"!==t[7]),(!gt||64&a[0])&&k(o,"disabled",t[6]),(!gt||16&a[0])&&ht!==(ht=t[4].text+"")&&v(S,ht),(!gt||16&a[0])&&$(A,"opacity",t[4].show?1:0),(!gt||64&a[0])&&(H.disabled=t[6]),(!gt||4&a[0])&&k(H,"is-activated",t[2]),(!gt||64&a[0])&&(J.disabled=t[6]),1&a[0]&&w(J,t[0]);let l=ot;ot=vt(t),ot===l?~ot&&xt[ot].p(t,a):(it&&(F(),D(xt[l],1,1,()=>{xt[l]=null}),T()),~ot?(it=xt[ot],it?it.p(t,a):(it=xt[ot]=ft[ot](t),it.c()),j(it,1),it.m(rt,null)):it=null)},i(t){gt||(j(nt.$$.fragment,t),j(it),j(ct.$$.fragment,t),gt=!0)},o(t){D(nt.$$.fragment,t),D(it),D(ct.$$.fragment,t),gt=!1},d(a){a&&g(e),function(t,e){for(let a=0;a<t.length;a+=1)t[a]&&t[a].d(e)}(mt,a),t[25](null),a&&g(lt),W(nt,a),a&&g(st),a&&g(rt),~ot&&xt[ot].d(),a&&g(dt),W(ct,a),ut=!1,l(pt)}}}const Dl=()=>{},Vl=()=>{};function Kl(t,e,a){let l,n=new Set(["local","module","global"]),s="local";st.set(s);let r=s,o=void 0,i=void 0;const d=Pe.layerColorScales,c=Pe.nodeLength,g=Pe.numLayers,u=Pe.edgeOpacity,p=Pe.edgeInitColor,h=Pe.edgeHoverColor,y=Pe.edgeStrokeWidth,m=Pe.svgPaddings,f=Pe.overlayRectOffset;let x=[void 0,void 0];it.subscribe(t=>{x=t});let v=void 0;nt.subscribe(t=>{v=t});let b=void 0;rt.subscribe(t=>{b=t}),ot.subscribe(t=>{});let $=void 0;dt.subscribe(t=>{a(2,$=t)}),ct.subscribe(t=>{}),at.subscribe(t=>{});let w=void 0;lt.subscribe(t=>{w=t});let k=void 0;gt.subscribe(t=>{k=t});let I=void 0;ut.subscribe(t=>{a(3,I=t)});let L=void 0;yt.subscribe(t=>{L=t});let A=void 0;ht.subscribe(t=>{a(4,A=t)});let E=void 0;mt.subscribe(t=>{E=t});let R=void 0,S=void 0,_=void 0,N={layerName:"",index:-1,data:null},H=!1,P=!1,O=-1,B=-1,X=void 0,G=!1,q=void 0;const z={input:0,conv_1_1:1,relu_1_1:2,conv_1_2:3,relu_1_2:4,max_pool_1:5,conv_2_1:6,relu_2_1:7,conv_2_2:8,relu_2_2:9,max_pool_2:10,output:11},F={0:{local:"input-legend",module:"input-legend",global:"input-legend"},1:{local:"local-legend-0-1",module:"module-legend-0",global:"global-legend"},2:{local:"local-legend-0-1",module:"module-legend-0",global:"global-legend"},3:{local:"local-legend-0-2",module:"module-legend-0",global:"global-legend"},4:{local:"local-legend-0-2",module:"module-legend-0",global:"global-legend"},5:{local:"local-legend-0-2",module:"module-legend-0",global:"global-legend"},6:{local:"local-legend-1-1",module:"module-legend-1",global:"global-legend"},7:{local:"local-legend-1-1",module:"module-legend-1",global:"global-legend"},8:{local:"local-legend-1-2",module:"module-legend-1",global:"global-legend"},9:{local:"local-legend-1-2",module:"module-legend-1",global:"global-legend"},10:{local:"local-legend-1-2",module:"module-legend-1",global:"global-legend"},11:{local:"output-legend",module:"output-legend",global:"output-legend"}};let T,j=[{file:"boat_1.jpeg",class:"Rettungsboot"},{file:"bug_1.jpeg",class:"Marienkäfer"},{file:"pizza_1.jpeg",class:"Pizza"},{file:"pepper_1.jpeg",class:"Paprika"},{file:"bus_1.jpeg",class:"Schulbus"},{file:"koala_1.jpeg",class:"Koala"},{file:"espresso_1.jpeg",class:"Kaffe"},{file:"panda_1.jpeg",class:"Pandabär"},{file:"orange_1.jpeg",class:"Orange"},{file:"car_1.jpeg",class:"Rennauto"}],D=j[6].file,V=-1,K=!0,W=!0,Y=null;const U=(t,e,a)=>{void 0===X&&i.select("rect#underneath-gateway-"+t.index).style("opacity",1)},J=(t,e,a)=>{void 0===X&&i.select("rect#underneath-gateway-"+t.index).style("opacity",0)},Q=(t,e,l,n,r)=>{if(d3.event.stopPropagation(),a(11,W=!1),X===t.index)a(9,V=-1),X=void 0,i.select("rect#underneath-gateway-"+t.index).style("opacity",0);else{a(9,V=t.index);t.output,t.outputLinks[n].weight;let e=b[s][r-1],l=b[s][r],o=Math.max(e,l);void 0!==X&&(i.select("rect#underneath-gateway-"+X).style("opacity",0),i.select("rect#underneath-gateway-"+t.index).style("opacity",1));let d=d3.select("#cnn-svg"),c=+d.style("height").replace("px","")/2,g=+d.style("width").replace("px",""),u=100+c-125,p=E[Object.keys(z)[r]],h=0;r>6?(h=(p-m.left)/2,h=m.left+h-243):(h=(g+m.right-p)/2,h=p+h-243);const y=document.getElementById("detailview");y.style.top=u+"px",y.style.left=h+"px",y.style.position="absolute",X=t.index,a(8,T.colorRange=o,T),a(8,T.inputIsInputLayer=r<=1,T)}},Z=()=>{if(void 0!==X)a(9,V=-1),i.select("rect#underneath-gateway-"+X).style("opacity",0),X=void 0;else if(k)i.select(".softmax-symbol").dispatch("click");else if(H){let t=z[N.layerName];$t(t,N.domG,N.domI),d3.select(N.domG[N.domI]).dispatch("mouseleave")}else P&&ft()},ft=()=>{P=!1,O=-1;let t=z[N.layerName],e=N.index;i.select(`g#layer-${t}-node-${e}`).select("rect.bounding").classed("hidden",!0),N.data.inputLinks.forEach(t=>{let e=z[t.source.layerName],a=t.source.index;i.select(`g#layer-${e}-node-${a}`).select("rect.bounding").classed("hidden",!0)}),i.select("g.underneath").selectAll("rect").remove();i.select("g.edge-group").selectAll(".edge").filter(t=>t.targetLayerIndex!==B).style("visibility",null);a(6,G=!1),i.selectAll(`.${s}-legend`).classed("hidden",!$),i.selectAll(".input-legend").classed("hidden",!$),i.selectAll(".output-legend").classed("hidden",!$),i.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${t}-${e}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",p).style("stroke-width",y).style("opacity",u),i.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(t,e,a)=>{i.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").remove(),i.selectAll("defs.overlay-gradient").remove(),i.select(".input-annotation").classed("hidden",!1)}),i.select("g#cnn-layer-group-"+t).selectAll("g.node-group").each((t,e,a)=>{d3.select(a[e]).style("pointer-events","all")}),i.select("g#cnn-layer-group-"+(t-1)).selectAll("g.node-group").each((t,e,a)=>{d3.select(a[e]).style("pointer-events","all").on("mouseover",kt).on("mouseleave",It).on("click",wt)}),a(5,N.layerName="",N),a(5,N.index=-1,N),a(5,N.data=null,N),B=-1},xt=(t,e,a)=>{let l=z[t.layerName],n=t.index;i.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${B}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",h).style("stroke-width","1").style("opacity",1),d3.select(a[e]).select("rect.bounding").classed("hidden",!1);let s=l-1;l===B-1&&(s=l+1),i.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!1)},vt=(t,e,a)=>{let l=z[t.layerName],n=t.index;i.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${B}-${n}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",p).style("stroke-width",y).style("opacity",u),d3.select(a[e]).select("rect.bounding").classed("hidden",!0);let s=l-1;l===B-1&&(s=l+1),i.select(`g#layer-${s}-node-${n}`).select("rect.bounding").classed("hidden",!0)},bt=(t,e,a)=>{let l=z[t.layerName],n=t.index;i.select(`g#layer-${l+1}-node-${n}`).node().dispatchEvent(new Event("click"))},$t=(t,e,l)=>{k&&(i.select(".logit-layer").remove(),i.select(".logit-layer-lower").remove(),i.selectAll(".plus-symbol-clone").remove(),i.select(".underneath").selectAll(".logit-lower").style("opacity",0),ut.set({show:!1,logits:[]}),pt.set(!1)),gt.set(!1),H=!1,i.selectAll(`.${s}-legend`).classed("hidden",!$),i.selectAll(".input-legend").classed("hidden",!$),i.selectAll(".output-legend").classed("hidden",!$),a(6,G=!1);for(let e=0;e<q[t-1].length;e++)i.select(`g#layer-${t-1}-node-${e}`).on("mouseover",kt).on("mouseleave",It).on("click",wt);i.select("g.underneath").selectAll("rect").remove(),X=void 0,i.select("g#cnn-layer-group-"+(t-1)).selectAll("rect.bounding").style("stroke-width",1),d3.select(e[l]).select("rect.bounding").style("stroke-width",1),i.selectAll(`g#layer-label-${t-1},\n      g#layer-detailed-label-${t-1},\n      g#layer-label-${t},\n      g#layer-detailed-label-${t}`).style("font-weight","normal"),a(5,N.layerName="",N),a(5,N.index=-1,N),a(5,N.data=null,N),a(11,W=!0);let n=i.select("g.intermediate-layer");if(ct.set(!1),n.transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(t,e,a)=>{d3.select(a[e]).remove()}),i.selectAll(".overlay-group").remove(),i.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").transition("remove").duration(500).ease(d3.easeCubicInOut).style("opacity",0).on("end",(t,e,a)=>{i.selectAll("g.intermediate-layer-overlay, g.intermediate-layer-annotation").remove(),i.selectAll("defs.overlay-gradient").remove()}),void 0!==x[0]){let t=b[s][x[0]];void 0!==x[1]?i.select(`g#layer-${x[0]}-node-${x[1]}`).select("image.node-image").each((e,a,l)=>ra(e,a,l,t)):i.select("g#cnn-layer-group-"+x[0]).selectAll("image.node-image").each((e,a,l)=>ra(e,a,l,t))}for(let t=0;t<g;t++)xa({layerIndex:t,targetX:v[t][0].x,disable:!1,delay:500,opacity:1});xa({layerIndex:g-2,targetX:v[g-2][0].x,opacity:1,disable:!1,delay:500,onEndFunc:()=>{i.select("g.edge-group").style("visibility","visible"),i.select(".input-annotation").classed("hidden",!1)}})},wt=(t,e,l)=>{d3.event.stopPropagation();let n=t.index;if(a(5,N.layerName=t.layerName,N),a(5,N.index=t.index,N),a(5,N.data=t,N),a(5,N.domI=e,N),a(5,N.domG=l,N),"conv"===t.type||"relu"===t.type||"pool"===t.type){let e=[];for(let a=0;a<t.inputLinks.length;a++)e.push({input:t.inputLinks[a].source.output,kernel:t.inputLinks[a].weight,output:t.inputLinks[a].dest.output});let l=z[t.layerName];e.colorRange=b[s][l],e.isInputInputLayer=l<=1,a(8,T=e)}let r=z[t.layerName];if("relu"==t.type||"pool"==t.type)if(a(10,K=!1),P)if(t.index===O)ft();else{i.select(`g#layer-${r}-node-${O}`).select("rect.bounding").classed("hidden",!0),i.select(`g#layer-${r-1}-node-${O}`).select("rect.bounding").classed("hidden",!0);let t=i.select("g.cnn-group").select("g.edge-group");t.selectAll(`path.edge-${r}-${O}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",p).style("stroke-width",y).style("opacity",u);let e=i.select("g.underneath");e.select("#underneath-gateway-"+O).style("opacity",0),i.select(`g#layer-${r}-node-${n}`).select("rect.bounding").classed("hidden",!1),i.select(`g#layer-${r-1}-node-${n}`).select("rect.bounding").classed("hidden",!1),t.selectAll(`path.edge-${r}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",h).style("stroke-width","1").style("opacity",1),e.select("#underneath-gateway-"+n).style("opacity",1),O=n}else((t,e)=>{P=!0,O=e,B=t;let l=d3.select("#cnn-svg"),n=+l.style("height").replace("px","")/2,r=+l.style("width").replace("px",""),o=100+n-130,d=0;t>5?(d=v[t-1][0].x+50,d=d/2-250):(d=(r-v[t][0].x-c)/2,d=v[t][0].x+c+d-250);const g=document.getElementById("detailview");g.style.top=o+"px",g.style.left=d+"px",g.style.position="absolute";i.select("g.edge-group").selectAll(".edge").filter(e=>e.targetLayerIndex!==t).style("visibility","hidden");a(6,G=!0),i.select(".input-annotation").classed("hidden",!0),i.selectAll(`.${s}-legend`).classed("hidden",!0),i.selectAll(".input-legend").classed("hidden",!0),i.selectAll(".output-legend").classed("hidden",!0),i.select("#"+F[t][s]).classed("hidden",!1);let u=v[t-1][e].x,p=v[t][e].x+c+5,h=R-p-f/2,y=u-v[0][0].x;if(h>y){let t=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:1}];va("overlay-gradient-right",t),t=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85+y/h*(.95-.85)},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}],va("overlay-gradient-left",t)}else{let t=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:1},{offset:"50%",color:"rgb(250, 250, 250)",opacity:.9},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85}];va("overlay-gradient-left",t),t=[{offset:"0%",color:"rgb(250, 250, 250)",opacity:.85},{offset:"100%",color:"rgb(250, 250, 250)",opacity:.85+h/y*(.95-.85)}],va("overlay-gradient-right",t)}Qa("overlay-gradient-right",p+f/2+.5,0,h,S+m.top),Qa("overlay-gradient-left",v[0][0].x-f/2,0,y,S+m.top),i.selectAll("rect.overlay").on("click",Z);let x=i.select("g.underneath");for(let e=0;e<q[t-1].length;e++)x.append("rect").attr("class","underneath-gateway").attr("id","underneath-gateway-"+e).attr("x",v[t-1][e].x-7).attr("y",v[t-1][e].y-7).attr("width",2*c+w+14).attr("height",c+14).attr("rx",10).style("fill","rgba(160, 160, 160, 0.3)").style("opacity",0),i.select(`g#layer-${t-1}-node-${e}`).style("pointer-events","all").style("cursor","pointer").on("mouseover",xt).on("mouseleave",vt).on("click",bt);x.lower(),x.select("#underneath-gateway-"+e).style("opacity",1)})(r,t.index);"conv"!==t.type&&"output"!==t.layerName||H?"conv"!==t.type&&"output"!==t.layerName||!H||$t(r,l,e):(((t,e,l,n)=>{H=!0,i.selectAll(`.${s}-legend`).classed("hidden",!0),i.selectAll(".input-legend").classed("hidden",!0),i.selectAll(".output-legend").classed("hidden",!0),i.select(".input-annotation").classed("hidden",!0),i.select("g#cnn-layer-group-"+(n-1)).selectAll("rect.bounding").style("stroke-width",2),d3.select(e[l]).select("rect.bounding").style("stroke-width",2),a(6,G=!0),ct.set(!0),i.selectAll(`g#layer-label-${n-1},\n      g#layer-detailed-label-${n-1},\n      g#layer-label-${n},\n      g#layer-detailed-label-${n}`).style("font-weight","800"),d3.select("#cnn-svg").on("click",Z)})(0,l,n,r),"conv_1_1"===t.layerName?tl(r,t,n,R,S,U,J,Q):"conv_1_2"===t.layerName?el(r,t,n,R,S,U,J,Q):"conv_2_1"===t.layerName?al(r,t,n,R,S,U,J,Q):"conv_2_2"===t.layerName?ll(r,t,n,R,S,U,J,Q):"output"===t.layerName&&Bl(r,t,n,0,S))},kt=(t,e,a)=>{if(H)return;let l=z[t.layerName],n=t.index;if(i.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${l}-${n}`).raise().transition().ease(d3.easeCubicInOut).duration(400).style("stroke",h).style("stroke-width","1").style("opacity",1),d3.select(a[e]).select("rect.bounding").classed("hidden",!1),1===t.inputLinks.length){let e=t.inputLinks[0],a=z[e.source.layerName],l=e.source.index;i.select(`g#layer-${a}-node-${l}`).select("rect.bounding").classed("hidden",!1)}else i.select("g#cnn-layer-group-"+(l-1)).selectAll("g.node-group").selectAll("rect.bounding").classed("hidden",!1);"output"===t.layerName&&d3.select(a[e]).select(".output-text").style("opacity",.8).style("text-decoration","underline")},It=(t,e,a)=>{if(!H&&(P||t.layerName!==N.layerName||t.index!==N.index)){let l=z[t.layerName],n=t.index;if(i.select("g.cnn-group").select("g.edge-group").selectAll(`path.edge-${l}-${n}`).transition().ease(d3.easeCubicOut).duration(200).style("stroke",p).style("stroke-width",y).style("opacity",u),d3.select(a[e]).select("rect.bounding").classed("hidden",!0),1===t.inputLinks.length){let e=t.inputLinks[0],a=z[e.source.layerName],l=e.source.index;i.select(`g#layer-${a}-node-${l}`).select("rect.bounding").classed("hidden",!0)}else i.select("g#cnn-layer-group-"+(l-1)).selectAll("g.node-group").selectAll("rect.bounding").classed("hidden",t=>t.layerName!==N.layerName||t.index!==N.index);"output"===t.layerName&&d3.select(a[e]).select(".output-text").style("fill","black").style("opacity",.5).style("text-decoration","none")}};M(async()=>{o=d3.select(l).select("#cnn-svg"),i=o.append("g").attr("class","main-svg").attr("transform",`translate(${m.left}, 0)`),et.set(i),R=Number(o.style("width").replace("px",""))-m.left-m.right,S=Number(o.style("height").replace("px",""))-m.top-m.bottom;let t=i.append("g").attr("class","cnn-group");i.append("g").attr("class","underneath"),o.style("height").replace("px","");var e;i.append("defs").append("marker").attr("id","marker").attr("viewBox","0 -5 10 10").attr("refX",6).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("stroke-width",1.2).style("fill","gray").style("stroke","gray").attr("d","M0,-5L10,0L0,5"),i.append("defs").append("marker").attr("id","marker-alt").attr("viewBox","0 -5 10 10").attr("refX",6).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").style("fill","none").style("stroke","gray").style("stroke-width",2).attr("d","M-5,-10L10,0L-5,10"),console.time("Construct cnn"),_=await(e="/cnn-explainer/assets/data/model.json",tf.loadLayersModel(e)),q=await _e("/cnn-explainer/assets/img/"+D,_),console.timeEnd("Construct cnn"),tt.set(q);let a=q[q.length-2];q.splice(q.length-2,1),q.flatten=a,console.log(q),ga(),da(R,S,t,kt,It,wt)});const Lt=async t=>{a(12,Y=t.detail.url),q=await _e(Y,_);let e=q[q.length-2];q.splice(q.length-2,1),q.flatten=e,tt.set(q),((t,e)=>{let a=t.width,l=e[0].output.length,n=document.createElement("canvas"),s=n.getContext("2d");n.width=l,n.height=l;let r=s.getImageData(0,0,l,l),o=r.data;for(let t=0;t<o.length;t+=4){let a=Math.floor(t/4),n=Math.floor(a/l),s=a%l,r=e[0].output[n][s],i=e[1].output[n][s],d=e[2].output[n][s];o[t]=255*r,o[t+1]=255*i,o[t+2]=255*d,o[t+3]=255}let i=document.createElement("canvas");i.width=3*a,i.height=3*a;let d=i.getContext("2d");s.putImageData(r,0,0),d.drawImage(n,0,0,l,l,0,0,3*a,3*a);let c=i.toDataURL();t.src=c,n.remove(),i.remove()})(d3.select(l).select(".custom-image").node(),q[0]),ga(),ca()};return t.$$.update=()=>{1&t.$$.dirty[0]&&(()=>{if(void 0!==i){if(n.add(s)||console.error("Encounter unknown scale level!"),s!=r){({local:{module:[1,2,8,9,10],global:[1,2,3,4,5,8,9,10]},module:{local:[1,2,8,9,10],global:[1,2,3,4,5,8,9,10]},global:{local:[1,2,3,4,5,8,9,10],module:[1,2,3,4,5]}})[r][s].forEach(t=>{let e=b[s][t];i.select("#cnn-layer-group-"+t).selectAll(".node-image").each((t,a,l)=>ra(t,a,l,e))}),i.selectAll(`.${r}-legend`).classed("hidden",!0),i.selectAll(`.${s}-legend`).classed("hidden",!$)}r=s,st.set(s)}})()},[s,l,$,I,A,N,G,D,T,V,K,W,Y,d,j,()=>{a(2,$=!$),dt.set($),H||(i.selectAll(`.${s}-legend`).classed("hidden",!$),i.selectAll(".input-legend").classed("hidden",!$),i.selectAll(".output-legend").classed("hidden",!$)),i.selectAll(".layer-detailed-label").classed("hidden",!$),i.selectAll(".layer-label").classed("hidden",$)},async t=>{let e=d3.select(t.target).attr("data-imageName");if(e!==D){a(7,D=e),q=await _e("/cnn-explainer/assets/img/"+D,_);let t=q[q.length-2];q.splice(q.length-2,1),q.flatten=t,tt.set(q),ga(),ca()}},()=>{if(null===Y)L.show=!0,L.preImage=D,yt.set(L);else if("custom"!==D){Lt({detail:{url:Y}})}else L.show=!0,L.preImage=D,yt.set(L);"custom"!==D&&a(7,D="custom")},t=>{a(7,D=t.detail.preImage)},Lt,function(t){t.detail.text&&(X=void 0,i.select("rect#underneath-gateway-"+V).style("opacity",0),a(9,V=-1))},function(t){t.detail.text&&(ft(),a(10,K=!0))},function(t){t.detail.text&&(ft(),a(10,K=!0))},function(t){a(3,I.show=!1,I),ut.set(I)},function(){s=function(t){const e=t.querySelector(":checked");return e&&e.__value}(this),a(0,s)},function(t){C[t?"unshift":"push"](()=>{l=t,a(1,l)})}]}class Wl extends J{constructor(t){super(),U(this,t,Kl,jl,s,{},null,[-1,-1,-1])}}function Yl(e){let a,l,n;return l=new Wl({}),{c(){a=u("div"),V(l.$$.fragment),f(a,"id","explainer"),f(a,"class","svelte-1avhf6")},m(t,e){c(t,a,e),K(l,a,null),n=!0},p:t,i(t){n||(j(l.$$.fragment,t),n=!0)},o(t){D(l.$$.fragment,t),n=!1},d(t){t&&g(a),W(l)}}}function Ul(t){return[]}class Jl extends J{constructor(t){super(),U(this,t,Ul,Yl,s,{})}}function Ql(e){let a;return{c(){a=u("div"),a.innerHTML='<div id="logo" class="svelte-qob9ex"><div id="logo-text" class="svelte-qob9ex">KI zum Ausprobieren</div> \n\n\t\t<svg width="510px" height="50px"><defs><filter x="0%" y="0%" width="100%" height="100%" filterUnits="objectBoundingBox" id="chalk-texture"><feTurbulence type="fractalNoise" baseFrequency="2" numOctaves="5" stitchTiles="stitch" result="f1"></feTurbulence><feColorMatrix type="matrix" values="0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 -1.5 1.5" result="f2"></feColorMatrix><feComposite operator="in" in2="f2" in="SourceGraphic" result="f3"></feComposite></filter></defs><g filter="url(#chalk-texture)" transform="translate(0, 35)"><text id="svg-logo-tagline" class="svelte-qob9ex">Wie funktioniert eine KI für Bilderkennung?</text></g></svg></div> \n\n\t<div class="icons svelte-qob9ex"><div class="icon svelte-qob9ex" title="Research paper"><a target="_blank" href="https://arxiv.org/abs/2004.15004" class="svelte-qob9ex"><img src="/cnn-explainer/assets/img/pdf.png" alt="pdf icon" class="svelte-qob9ex"/></a></div> \n\n\t\t<div class="icon svelte-qob9ex" title="Demo video"><a target="_blank" href="https://youtu.be/HnWIHWFbuUQ" class="svelte-qob9ex"><img src="/cnn-explainer/assets/img/youtube.png" alt="youtube icon" class="svelte-qob9ex"/></a></div> \n\n\t\t<div class="icon svelte-qob9ex" title="Open-source code"><a target="_blank" href="https://github.com/poloclub/cnn-explainer" class="svelte-qob9ex"><img src="/cnn-explainer/assets/img/github.png" alt="github icon" class="svelte-qob9ex"/></a></div></div>',f(a,"id","header"),f(a,"class","svelte-qob9ex")},m(t,e){c(t,a,e)},p:t,i:t,o:t,d(t){t&&g(a)}}}class Zl extends J{constructor(t){super(),U(this,t,null,Ql,s,{})}}function tn(e){let a,l,n,s,r,o,i;return s=new Zl({}),o=new Jl({}),{c(){a=u("div"),l=u("recommender-overlay"),n=h(),V(s.$$.fragment),r=h(),V(o.$$.fragment),x(l,"my-brand","CNN Explainer"),x(l,"brands-to-ignore","CNN 101"),x(l,"recommendation-count","10"),x(l,"similar-candidate-count","15"),x(l,"position-left","30"),x(l,"display-delay","30000"),x(l,"homepage-url","https://poloclub.github.io/"),f(a,"id","app-page")},m(t,e){c(t,a,e),d(a,l),d(a,n),K(s,a,null),d(a,r),K(o,a,null),i=!0},p:t,i(t){i||(j(s.$$.fragment,t),j(o.$$.fragment,t),i=!0)},o(t){D(s.$$.fragment,t),D(o.$$.fragment,t),i=!1},d(t){t&&g(a),W(s),W(o)}}}return new class extends J{constructor(t){super(),U(this,t,null,tn,s,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
